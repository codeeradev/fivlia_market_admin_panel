import{o as d,g as I,h as v,i as a,t as n,d as e,c as y,j as N,r as x,q as V,k as q,l as R,w,x as B,y as O,F,f as z}from"./index-C7CxpWWS.js";import{_ as G}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CPyLgjyA.js";import{_ as W}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CSu2Ug9g.js";import{_ as H}from"./BaseTable.vue_vue_type_script_setup_true_lang-Bz3J-Bwq.js";import{_ as D}from"./BaseModal-DHfszBKZ.js";import{g as J,E as T,p as M}from"./endpoint-CWcXRKaZ.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"space-y-4 text-sm"},X={class:"flex gap-4"},Y=["src"],Z={class:"space-y-1"},ee={class:"text-lg font-semibold"},te={class:"capitalize text-gray-500"},se={key:0,class:"font-semibold text-theme"},le={key:0,class:"grid grid-cols-2 gap-3"},oe={key:1,class:"grid grid-cols-2 gap-3"},ne={class:"flex items-center gap-4"},re=["src"],ie={__name:"ViewApprovalModal",props:{item:{type:Object,required:!0},imgUrl:{type:Function,required:!0}},setup(r){return(C,l)=>(d(),I(D,{onClose:l[1]||(l[1]=g=>C.$emit("close"))},{title:v(()=>[a(n(r.item.type==="product"?"Product Details":"Banner Details"),1)]),default:v(()=>{var g,f,p,b,k,c,A;return[e("div",Q,[e("div",X,[e("img",{src:r.imgUrl(r.item.image),class:"h-32 w-32 rounded-xl border object-cover"},null,8,Y),e("div",Z,[e("div",ee,n(r.item.name||r.item.title),1),e("div",te,n(r.item.type),1),r.item.price!=null?(d(),y("div",se,"Rs. "+n(r.item.price),1)):N("",!0)])]),l[14]||(l[14]=e("hr",null,null,-1)),r.item.type==="product"?(d(),y("div",le,[e("div",null,[l[2]||(l[2]=e("strong",null,"Description:",-1)),a(" "+n(r.item.description||"-"),1)]),e("div",null,[l[3]||(l[3]=e("strong",null,"Address:",-1)),a(" "+n(r.item.address||"-"),1)]),e("div",null,[l[4]||(l[4]=e("strong",null,"Expiry:",-1)),a(" "+n(r.item.expiryDays||"-")+" days",1)]),e("div",null,[l[5]||(l[5]=e("strong",null,"Status:",-1)),a(" "+n(r.item.productStatus||"-"),1)])])):(d(),y("div",oe,[e("div",null,[l[6]||(l[6]=e("strong",null,"Title:",-1)),a(" "+n(r.item.title||"-"),1)]),e("div",null,[l[7]||(l[7]=e("strong",null,"Main Category:",-1)),a(" "+n(((g=r.item.mainCategory)==null?void 0:g.name)||"-"),1)]),e("div",null,[l[8]||(l[8]=e("strong",null,"City:",-1)),a(" "+n(((f=r.item.cityId)==null?void 0:f.city)||((p=r.item.cityId)==null?void 0:p.name)||r.item.cityId||"-"),1)]),e("div",null,[l[9]||(l[9]=e("strong",null,"Status:",-1)),a(" "+n(r.item.aprroveStatus||"-"),1)])])),l[15]||(l[15]=e("hr",null,null,-1)),e("div",null,[l[13]||(l[13]=e("h4",{class:"mb-2 font-semibold"},"User",-1)),e("div",ne,[e("img",{src:r.imgUrl((b=r.item.userId)==null?void 0:b.image),class:"h-16 w-16 rounded-full border object-cover"},null,8,re),e("div",null,[e("div",null,[l[10]||(l[10]=e("strong",null,"Name:",-1)),a(" "+n(((k=r.item.userId)==null?void 0:k.name)||"-"),1)]),e("div",null,[l[11]||(l[11]=e("strong",null,"Email:",-1)),a(" "+n(((c=r.item.userId)==null?void 0:c.email)||"-"),1)]),e("div",null,[l[12]||(l[12]=e("strong",null,"Mobile:",-1)),a(" "+n(((A=r.item.userId)==null?void 0:A.mobileNumber)||"-"),1)])])])])])]}),footer:v(()=>[e("button",{class:"rounded bg-gray-300 px-4 py-2",onClick:l[0]||(l[0]=g=>C.$emit("close"))},"Close")]),_:1}))}},ae={class:"rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/5 xl:px-10 xl:py-12"},de={class:"mb-4 flex flex-col items-start justify-between gap-3 md:flex-row md:items-center"},ue={class:"flex items-center gap-2"},pe={class:"flex items-center gap-2"},ce={class:"text-sm text-gray-500"},me={class:"text-gray-700 dark:text-white/90"},ve={key:0,class:"py-10 text-center"},ye={key:1,class:"py-10 text-center text-gray-500"},ge={key:2},xe={class:"px-4 py-3"},fe=["href"],be=["src"],ke={class:"px-4 py-3 font-medium"},$e={class:"px-4 py-3"},Ce={class:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800"},Ae={class:"px-4 py-3 font-semibold text-theme"},he={class:"px-4 py-3"},Ie=["onClick"],Ne={class:"px-4 py-3"},Se={class:"rounded bg-yellow-400 px-3 py-1 text-xs text-black"},Ue={class:"px-4 py-3"},_e={class:"flex gap-2"},Te=["onClick"],Pe=["onClick"],Ee=["onClick"],je=["onClick"],Re={class:"space-y-3 text-sm"},we={class:"flex items-start gap-3"},Me=["src"],De={__name:"Approvals",setup(r){const C=x("Approvals"),l=x([]),g=x(!0),f=x(!1),p=x(null),b=x(!1),k=x(null),c=x({type:"all",q:""}),A="https://fivliaproject.s3.eu-north-1.amazonaws.com",h=s=>{if(!s)return"/no-image.png";if(/^https?:\/\//i.test(s))return s;const t=A.replace(/\/+$/,""),o=s.startsWith("/")?s:`/${s}`;return`${t}${o}`},P=(s,t)=>{const o=Array.isArray(s==null?void 0:s.image)?s.image[0]:s==null?void 0:s.image;return{...s,type:t,image:o||"",displayName:(s==null?void 0:s.name)||(s==null?void 0:s.title)||"-",price:(s==null?void 0:s.price)??null}},S=async()=>{try{g.value=!0;const s=await J(T.GET_PRODUCT_FOR_APPROVALS),t=(s==null?void 0:s.Approvals)||{},o=Array.isArray(t.banners)?t.banners.map(i=>P(i,"banner")):[],u=Array.isArray(t.products)?t.products.map(i=>P(i,"product")):[];l.value=[...o,...u]}catch(s){console.error("Error loading approvals:",s),l.value=[]}finally{g.value=!1}},U=async(s,t)=>{var o,u;try{if(!(s!=null&&s._id))return;if(s.type==="product")await M(T.UPDATE_PRODUCT_STATUS(s._id),{productStatus:t});else{const i={aprroveStatus:t};if(t==="rejected"||t==="resubmit"){const m=window.prompt(t==="resubmit"?"Enter resubmit reason":"Enter rejection reason");if(!m||!m.trim())return;i.approvalReason=m.trim()}await M(T.UPDATE_BANNER_APPROVAL(s._id),i)}await S()}catch(i){console.error("Status update failed:",i),alert(((u=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:u.message)||"Failed to update status")}},_=V(()=>{const s=(c.value.q||"").toLowerCase().trim();return l.value.filter(t=>{var m,$;if(c.value.type!=="all"&&t.type!==c.value.type)return!1;if(!s)return!0;const o=(t.displayName||"").toLowerCase(),u=(((m=t.userId)==null?void 0:m.name)||"").toLowerCase(),i=((($=t.userId)==null?void 0:$.email)||"").toLowerCase();return o.includes(s)||u.includes(s)||i.includes(s)})}),L=s=>{p.value=s,f.value=!0},E=()=>{f.value=!1,p.value=null};return q(S),(s,t)=>(d(),I(G,null,{default:v(()=>[R(W,{pageTitle:C.value},null,8,["pageTitle"]),e("div",ae,[t[14]||(t[14]=e("h2",{class:"mb-4 text-xl font-semibold text-gray-800 dark:text-white/90"},"Pending Approvals",-1)),e("div",de,[e("div",ue,[w(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>c.value.type=o),class:"rounded border px-3 py-2"},t[3]||(t[3]=[e("option",{value:"all"},"All types",-1),e("option",{value:"product"},"Products",-1),e("option",{value:"banner"},"Banners",-1)]),512),[[B,c.value.type]]),w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>c.value.q=o),type:"search",placeholder:"Search title / user",class:"w-64 rounded border px-3 py-2"},null,512),[[O,c.value.q]])]),e("div",pe,[e("button",{onClick:S,class:"rounded bg-blue-600 px-3 py-2 text-sm text-white"}," Refresh "),e("div",ce,[t[4]||(t[4]=a(" Total: ")),e("strong",me,n(_.value.length),1)])])]),g.value?(d(),y("div",ve,t[5]||(t[5]=[e("div",{class:"flex items-center justify-center gap-3"},[e("div",{class:"h-10 w-10 animate-spin rounded-full border-4 border-gray-200 border-t-theme"}),e("div",{class:"text-sm text-gray-600 dark:text-gray-300"},"Loading approvals...")],-1)]))):_.value.length===0?(d(),y("div",ye," No pending items for approval. ")):(d(),y("div",ge,[R(H,null,{head:v(()=>t[6]||(t[6]=[e("th",{class:"px-4 py-3"},"Preview",-1),e("th",{class:"px-4 py-3"},"Title / Name",-1),e("th",{class:"px-4 py-3"},"Type",-1),e("th",{class:"px-4 py-3"},"Price",-1),e("th",{class:"px-4 py-3"},"User",-1),e("th",{class:"px-4 py-3"},"Status",-1),e("th",{class:"px-4 py-3"},"Actions",-1)])),body:v(()=>[(d(!0),y(F,null,z(_.value,o=>{var u;return d(),y("tr",{key:o._id},[e("td",xe,[e("a",{href:h(o.image),target:"_blank",rel:"noreferrer"},[e("img",{src:h(o.image),class:"h-14 w-14 rounded-lg border object-cover"},null,8,be)],8,fe)]),e("td",ke,n(o.displayName),1),e("td",$e,[e("span",Ce,n(o.type),1)]),e("td",Ae,n(o.price!=null?`Rs. ${o.price}`:"-"),1),e("td",he,[e("button",{class:"text-blue-600 underline",onClick:i=>L(o.userId)},n(((u=o.userId)==null?void 0:u.name)||"N/A"),9,Ie)]),e("td",Ne,[e("span",Se,n(o.productStatus||o.aprroveStatus||"pending"),1)]),e("td",Ue,[e("div",_e,[e("button",{onClick:i=>U(o,"active"),class:"rounded bg-green-600 px-3 py-2 text-xs text-white"}," Approve ",8,Te),e("button",{onClick:i=>U(o,"rejected"),class:"rounded bg-red-600 px-3 py-2 text-xs text-white"}," Reject ",8,Pe),o.type==="banner"?(d(),y("button",{key:0,onClick:i=>U(o,"resubmit"),class:"rounded bg-orange-600 px-3 py-2 text-xs text-white"}," Resubmit ",8,Ee)):N("",!0),e("button",{onClick:i=>{k.value=o,b.value=!0},class:"rounded bg-indigo-600 px-3 py-2 text-xs text-white"}," View ",8,je)])])])}),128))]),_:1})])),f.value?(d(),I(D,{key:3,onClose:E},{title:v(()=>t[7]||(t[7]=[a("User Information")])),default:v(()=>{var o,u,i,m,$,j;return[e("div",Re,[e("div",null,[t[8]||(t[8]=e("strong",null,"Name:",-1)),a(" "+n((o=p.value)==null?void 0:o.name),1)]),e("div",null,[t[9]||(t[9]=e("strong",null,"Email:",-1)),a(" "+n((u=p.value)==null?void 0:u.email),1)]),e("div",null,[t[10]||(t[10]=e("strong",null,"Mobile:",-1)),a(" "+n((i=p.value)==null?void 0:i.mobileNumber),1)]),e("div",we,[t[11]||(t[11]=e("strong",null,"Profile:",-1)),e("img",{src:h((m=p.value)==null?void 0:m.image),class:"h-20 w-20 rounded-lg border object-cover"},null,8,Me)]),e("div",null,[t[12]||(t[12]=e("strong",null,"Latitude:",-1)),a(" "+n(($=p.value)==null?void 0:$.latitude),1)]),e("div",null,[t[13]||(t[13]=e("strong",null,"Longitude:",-1)),a(" "+n((j=p.value)==null?void 0:j.longitude),1)])])]}),footer:v(()=>[e("button",{class:"rounded bg-gray-300 px-4 py-2",onClick:E},"Close")]),_:1})):N("",!0),b.value?(d(),I(ie,{key:4,item:k.value,imgUrl:h,onClose:t[2]||(t[2]=o=>b.value=!1)},null,8,["item"])):N("",!0)])]),_:1}))}},Ge=K(De,[["__scopeId","data-v-80602cfb"]]);export{Ge as default};
