import{o as u,g as P,h as v,i as a,t as n,d as t,c as y,j as h,r as g,q as j,k as O,l as I,w as _,x as L,y as B,F as q,f as F}from"./index-DRCwg4EZ.js";import{_ as z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Bdc2VVU4.js";import{_ as G}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-T41Zm9iO.js";import{_ as H}from"./BaseTable.vue_vue_type_script_setup_true_lang-wmfEEMhB.js";import{_ as R}from"./BaseModal-DiLMXNfp.js";import{g as J,E as x,p as k}from"./endpoint-CWNBtn7N.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"space-y-4 text-sm"},W={class:"flex gap-4"},X=["src"],Y={class:"space-y-1"},Z={class:"text-lg font-semibold"},tt={class:"text-gray-500 capitalize"},et={key:0,class:"text-theme font-semibold"},st={key:0,class:"grid grid-cols-2 gap-3"},lt={key:1,class:"grid grid-cols-2 gap-3"},ot={class:"flex gap-4 items-center"},nt=["src"],rt={__name:"ViewApprovalModal",props:{item:Object,imgUrl:Function},setup(r){return($,l)=>(u(),P(R,{onClose:l[1]||(l[1]=m=>$.$emit("close"))},{title:v(()=>[a(n(r.item.type==="product"?"Product Details":"Banner Details"),1)]),default:v(()=>{var m,f,p,b,A;return[t("div",Q,[t("div",W,[t("img",{src:r.imgUrl(r.item.image),class:"h-32 w-32 rounded-xl object-cover border"},null,8,X),t("div",Y,[t("div",Z,n(r.item.name||r.item.title),1),t("div",tt,n(r.item.type),1),r.item.price?(u(),y("div",et," ₹ "+n(r.item.price),1)):h("",!0)])]),l[14]||(l[14]=t("hr",null,null,-1)),r.item.type==="product"?(u(),y("div",st,[t("div",null,[l[2]||(l[2]=t("strong",null,"Description:",-1)),a(" "+n(r.item.description||"—"),1)]),t("div",null,[l[3]||(l[3]=t("strong",null,"Address:",-1)),a(" "+n(r.item.address||"—"),1)]),t("div",null,[l[4]||(l[4]=t("strong",null,"Expiry:",-1)),a(" "+n(r.item.expiryDays)+" days",1)]),t("div",null,[l[5]||(l[5]=t("strong",null,"Status:",-1)),a(" "+n(r.item.productStatus),1)])])):(u(),y("div",lt,[t("div",null,[l[6]||(l[6]=t("strong",null,"Title:",-1)),a(" "+n(r.item.title),1)]),t("div",null,[l[7]||(l[7]=t("strong",null,"Main Category:",-1)),a(" "+n((m=r.item.mainCategory)==null?void 0:m.name),1)]),t("div",null,[l[8]||(l[8]=t("strong",null,"City:",-1)),a(" "+n(r.item.cityId),1)]),t("div",null,[l[9]||(l[9]=t("strong",null,"Status:",-1)),a(" "+n(r.item.aprroveStatus),1)])])),l[15]||(l[15]=t("hr",null,null,-1)),t("div",null,[l[13]||(l[13]=t("h4",{class:"font-semibold mb-2"},"User",-1)),t("div",ot,[t("img",{src:r.imgUrl((f=r.item.userId)==null?void 0:f.image),class:"h-16 w-16 rounded-full border object-cover"},null,8,nt),t("div",null,[t("div",null,[l[10]||(l[10]=t("strong",null,"Name:",-1)),a(" "+n((p=r.item.userId)==null?void 0:p.name),1)]),t("div",null,[l[11]||(l[11]=t("strong",null,"Email:",-1)),a(" "+n((b=r.item.userId)==null?void 0:b.email),1)]),t("div",null,[l[12]||(l[12]=t("strong",null,"Mobile:",-1)),a(" "+n((A=r.item.userId)==null?void 0:A.mobileNumber),1)])])])])])]}),footer:v(()=>[t("button",{class:"px-4 py-2 bg-gray-300 rounded",onClick:l[0]||(l[0]=m=>$.$emit("close"))}," Close ")]),_:1}))}},at={class:"rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/5 xl:px-10 xl:py-12"},it={class:"flex flex-col md:flex-row items-start md:items-center justify-between gap-3 mb-4"},dt={class:"flex items-center gap-2"},ut={class:"flex gap-2 items-center"},pt={class:"text-sm text-gray-500"},ct={class:"text-gray-700 dark:text-white/90"},vt={key:0,class:"text-center py-10"},mt={key:1,class:"text-center py-10 text-gray-500"},gt={key:2},yt={class:"px-4 py-3"},xt=["href"],ft=["src"],bt={class:"px-4 py-3 font-medium"},At={class:"px-4 py-3"},wt={class:"px-2 py-1 rounded text-xs bg-gray-100 text-gray-800"},St={class:"px-4 py-3 font-semibold text-theme"},$t={class:"px-4 py-3"},Ct=["onClick"],kt={class:"px-4 py-3"},Pt={class:"px-3 py-1 rounded text-xs bg-yellow-400 text-black"},Tt={class:"px-4 py-3"},Ut={class:"flex gap-2"},_t=["onClick"],ht=["onClick"],Dt=["onClick"],Et={class:"space-y-3 text-sm"},Nt={class:"flex items-start gap-3"},It=["src"],Lt={__name:"Approvals",setup(r){const $=g("Product Approvals"),l=g([]),m=g(!0),f=g(!1),p=g(null),b=g(!1),A=g(null),V="https://fivliaproject.s3.eu-north-1.amazonaws.com",C=o=>o?V+o:"/no-image.png",D=async()=>{try{m.value=!0;const o=await J(x.GET_PRODUCT_FOR_APPROVALS);let e=[];if(o!=null&&o.Approvals&&(o.Approvals.products||o.Approvals.banners)){const s=(o.Approvals.products||[]).map(d=>({...d,type:"product"}));e=[...(o.Approvals.banners||[]).map(d=>({...d,type:"banner"})),...s]}else if(Array.isArray(o==null?void 0:o.Approvals))e=o.Approvals.map(s=>({...s,type:s.type||(s.productStatus!==void 0?"product":"banner")}));else{const s=(o.Products||o.products||[]).map(d=>({...d,type:"product"}));e=[...(o.banners||o.Banners||[]).map(d=>({...d,type:"banner"})),...s]}l.value=e.map(s=>{const i=Array.isArray(s.image)?s.image[0]:s.image;return{...s,image:i||null,name:s.name||s.title||"—",price:s.price??null}})}catch(o){console.error("Error loading approvals:",o),l.value=[]}finally{m.value=!1}},E=async(o,e,s="product")=>{try{if(!o)return;if(s==="product")await k(`${x.UPDATE_PRODUCT_STATUS}/${o}`,{productStatus:e});else if(s==="banner"){const i=x.UPDATE_BANNER_APPROVAL?x.UPDATE_BANNER_APPROVAL(o):`${x.UPDATE_PRODUCT_STATUS}/${o}`;await k(i,{aprroveStatus:e})}else try{await k(`${x.UPDATE_PRODUCT_STATUS}/updateProductStatus/${o}`,{productStatus:e})}catch{await k(`${x.UPDATE_PRODUCT_STATUS}/updateBannerStatus/${o}`,{aprroveStatus:e})}l.value=l.value.filter(i=>i._id!==o),alert(`Status Updated: ${e}`)}catch(i){console.error("Status update failed:",i),alert("Failed to update status")}},c=g({type:"all",status:"pending",q:""}),T=j(()=>{const o=(c.value.q||"").toLowerCase().trim();return l.value.filter(e=>{var w,S;if(c.value.type!=="all"&&e.type!==c.value.type||c.value.status==="pending"&&(e.productStatus||e.aprroveStatus||"pending").toLowerCase()!=="pending")return!1;if(!o)return!0;const s=(e.name||e.title||"").toString().toLowerCase(),i=(((w=e.userId)==null?void 0:w.name)||"").toString().toLowerCase(),d=(((S=e.userId)==null?void 0:S.email)||"").toString().toLowerCase();return s.includes(o)||i.includes(o)||d.includes(o)||(e._id||"").toString().toLowerCase().includes(o)})}),M=o=>{p.value=o,f.value=!0},N=()=>{f.value=!1,p.value=null};return O(D),(o,e)=>(u(),P(z,null,{default:v(()=>[I(G,{pageTitle:$.value},null,8,["pageTitle"]),t("div",at,[e[16]||(e[16]=t("h2",{class:"text-xl font-semibold mb-4 text-gray-800 dark:text-white/90"},"Pending Approvals",-1)),t("div",it,[t("div",dt,[_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value.type=s),class:"px-3 py-2 border rounded"},e[4]||(e[4]=[t("option",{value:"all"},"All types",-1),t("option",{value:"product"},"Products",-1),t("option",{value:"banner"},"Banners",-1)]),512),[[L,c.value.type]]),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>c.value.status=s),class:"px-3 py-2 border rounded"},e[5]||(e[5]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"all"},"All",-1)]),512),[[L,c.value.status]]),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>c.value.q=s),type:"search",placeholder:"Search name / title / user...",class:"px-3 py-2 border rounded w-64"},null,512),[[B,c.value.q]])]),t("div",ut,[t("button",{onClick:D,class:"px-3 py-2 bg-blue-600 text-white rounded text-sm"}," Refresh "),t("div",pt,[e[6]||(e[6]=a(" Total: ")),t("strong",ct,n(T.value.length),1)])])]),m.value?(u(),y("div",vt,e[7]||(e[7]=[t("div",{class:"py-8 flex items-center justify-center"},[t("div",{class:"flex items-center gap-3"},[t("div",{class:"h-10 w-10 rounded-full animate-spin border-4 border-gray-200 border-t-theme"}),t("div",{class:"text-sm text-gray-600 dark:text-gray-300"},"Loading approvals...")])],-1)]))):T.value.length===0?(u(),y("div",mt," No pending items for approval. ")):(u(),y("div",gt,[I(H,null,{head:v(()=>e[8]||(e[8]=[t("th",{class:"px-4 py-3"},"Preview",-1),t("th",{class:"px-4 py-3"},"Title / Name",-1),t("th",{class:"px-4 py-3"},"Type",-1),t("th",{class:"px-4 py-3"},"Price",-1),t("th",{class:"px-4 py-3"},"User",-1),t("th",{class:"px-4 py-3"},"Status",-1),t("th",{class:"px-4 py-3"},"Actions",-1)])),body:v(()=>[(u(!0),y(q,null,F(T.value,s=>{var i;return u(),y("tr",{key:s._id},[t("td",yt,[t("a",{href:C(s.image),target:"_blank",rel:"noreferrer"},[t("img",{src:C(s.image),class:"h-14 w-14 rounded-lg object-cover border"},null,8,ft)],8,xt)]),t("td",bt,n(s.name),1),t("td",At,[t("span",wt,n(s.type),1)]),t("td",St,n(s.price?"₹ "+s.price:"—"),1),t("td",$t,[t("button",{class:"text-blue-600 underline",onClick:d=>M(s.userId)},n(((i=s.userId)==null?void 0:i.name)||"N/A"),9,Ct)]),t("td",kt,[t("span",Pt,n(s.productStatus||s.aprroveStatus||"pending"),1)]),t("td",Tt,[t("div",Ut,[t("button",{onClick:d=>E(s._id,"active",s.type),class:"px-3 py-2 bg-green-600 text-white rounded text-xs"}," Approve ",8,_t),t("button",{onClick:d=>E(s._id,"rejected",s.type),class:"px-3 py-2 bg-red-600 text-white rounded text-xs"}," Reject ",8,ht),t("button",{onClick:d=>{A.value=s,b.value=!0},class:"px-3 py-2 bg-indigo-600 text-white rounded text-xs"}," View ",8,Dt)])])])}),128))]),_:1})])),f.value?(u(),P(R,{key:3,onClose:N},{title:v(()=>e[9]||(e[9]=[a("User Information")])),default:v(()=>{var s,i,d,w,S,U;return[t("div",Et,[t("div",null,[e[10]||(e[10]=t("strong",null,"Name:",-1)),a(" "+n((s=p.value)==null?void 0:s.name),1)]),t("div",null,[e[11]||(e[11]=t("strong",null,"Email:",-1)),a(" "+n((i=p.value)==null?void 0:i.email),1)]),t("div",null,[e[12]||(e[12]=t("strong",null,"Mobile:",-1)),a(" "+n((d=p.value)==null?void 0:d.mobileNumber),1)]),t("div",Nt,[e[13]||(e[13]=t("strong",null,"Profile:",-1)),t("img",{src:C((w=p.value)==null?void 0:w.image),class:"h-20 w-20 rounded-lg object-cover border"},null,8,It)]),t("div",null,[e[14]||(e[14]=t("strong",null,"Latitude:",-1)),a(" "+n((S=p.value)==null?void 0:S.latitude),1)]),t("div",null,[e[15]||(e[15]=t("strong",null,"Longitude:",-1)),a(" "+n((U=p.value)==null?void 0:U.longitude),1)])])]}),footer:v(()=>[t("button",{class:"px-4 py-2 bg-gray-300 rounded",onClick:N},"Close")]),_:1})):h("",!0),b.value?(u(),P(rt,{key:4,item:A.value,imgUrl:C,onClose:e[3]||(e[3]=s=>b.value=!1)},null,8,["item"])):h("",!0)])]),_:1}))}},Ft=K(Lt,[["__scopeId","data-v-d2214ef2"]]);export{Ft as default};
