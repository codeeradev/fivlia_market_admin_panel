import{o,c as r,d as s,F as h,f as k,t as d,r as i,k as ee,g as M,h as I,l as se,n as te,j as f,i as ae,w as x,y as E,x as z}from"./index-DRCwg4EZ.js";import{_ as le}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-T41Zm9iO.js";import{_ as oe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Bdc2VVU4.js";import{_ as re}from"./BaseModal-DiLMXNfp.js";import{g as O,E as V,p as ne}from"./endpoint-CWNBtn7N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"overflow-x-auto"},de={class:"w-full table-auto"},ue={class:"px-4 py-3"},ce={class:"px-4 py-3"},ge={class:"px-4 py-3"},me={class:"px-4 py-3"},ve={key:0,class:"flex gap-2 max-w-[180px] overflow-x-auto"},ye=["src"],be={key:1,class:"text-gray-400 text-sm"},pe={class:"px-4 py-3"},fe={class:"px-4 py-3"},xe={class:"px-4 py-3"},_e={class:"px-4 py-3"},he={class:"px-4 py-3"},ke=["onClick"],we={__name:"ProductsTable",props:{products:{type:Array,default:()=>[]}},emits:["edit"],setup(j){const A="https://fivliaproject.s3.eu-north-1.amazonaws.com",U=u=>u?u.startsWith("http")||u.startsWith("blob:")?u:`${A}/${u.replace(/^\//,"")}`:"/no-image.png";return(u,m)=>(o(),r("div",ie,[s("table",de,[m[1]||(m[1]=s("thead",null,[s("tr",{class:"bg-gray-100 dark:bg-gray-800 text-left"},[s("th",{class:"px-4 py-3"},"#"),s("th",{class:"px-4 py-3"},"Name"),s("th",{class:"px-4 py-3"},"Category"),s("th",{class:"px-4 py-3"},"Images"),s("th",{class:"px-4 py-3"},"Price"),s("th",{class:"px-4 py-3"},"User"),s("th",{class:"px-4 py-3"},"Active Status"),s("th",{class:"px-4 py-3"},"Created"),s("th",{class:"px-4 py-3"},"Actions")])],-1)),s("tbody",null,[(o(!0),r(h,null,k(j.products,(n,w)=>{var y,v,g;return o(),r("tr",{key:n._id,class:"border-b border-gray-200 dark:border-gray-700"},[s("td",ue,d(w+1),1),s("td",ce,d(n.name),1),s("td",ge,d(((y=n.category)==null?void 0:y.name)||"-"),1),s("td",me,[(v=n.image)!=null&&v.length?(o(),r("div",ve,[(o(!0),r(h,null,k(n.image,(b,_)=>(o(),r("img",{key:_,src:U(b),class:"w-12 h-12 object-cover rounded border shrink-0",loading:"lazy"},null,8,ye))),128))])):(o(),r("span",be,"No Images"))]),s("td",pe,d(n.price),1),s("td",fe,d(((g=n.userId)==null?void 0:g.name)||"-"),1),s("td",xe,d(n.productStatus||"-"),1),s("td",_e,d(new Date(n.createdAt).toLocaleDateString()),1),s("td",he,[s("button",{class:"text-blue-600 hover:underline mr-3",onClick:b=>u.$emit("edit",n)}," Edit ",8,ke),m[0]||(m[0]=s("button",{class:"text-red-600 hover:underline"},"Delete",-1))])])}),128))])])]))}},Ce={class:"rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] lg:p-6"},$e={key:1,class:"flex justify-center py-6"},Pe={key:3,class:"flex items-center justify-between mt-6"},Se=["disabled"],Ie={class:"text-gray-700 dark:text-gray-300"},Ee=["disabled"],Ae={class:"grid grid-cols-1 gap-4"},Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},De=["value"],Ne=["disabled"],Me=["value"],Ve={key:0,class:"flex gap-2 max-w-full overflow-x-auto pb-1"},je=["src"],Fe={key:1,class:"text-sm text-gray-500"},Le={key:0,class:"text-xs text-gray-600 mt-1"},Re=["disabled"],ze=10,He={__name:"Products",setup(j){const A=i("Products"),U="https://fivliaproject.s3.eu-north-1.amazonaws.com",u=i(!0),m=i(!1),n=i({show:!1,type:"error",message:""}),w=i([]),y=i([]),v=i([]),g=i(1),b=i(1),_=i(!1),C=i(""),p=i([]),$=i([]),a=i({name:"",description:"",price:"",address:"",category:"",subCategory:""});function T(e){n.value={show:!0,type:"error",message:e}}function B(e){n.value={show:!0,type:"success",message:e}}async function P(){u.value=!0,n.value.show=!1;try{const e=await O(`${V.PRODUCTS}?page=${g.value}&limit=${ze}`);if(!e||!e.product){T("Invalid API response.");return}w.value=e.product,b.value=e.totalPages||1}catch(e){console.error(e),T("Failed to load products.")}finally{u.value=!1}}async function G(){try{const e=await O(V.CATEGORY.GET_ALL);y.value=(e==null?void 0:e.categories)||[]}catch(e){console.error(e),y.value=[]}}function W(e){return e?e.startsWith("http")||e.startsWith("blob:")?e:`${U}/${e.replace(/^\//,"")}`:"/no-image.png"}function F(e){return e?typeof e=="string"?e:typeof e=="object"?e._id||e.id||"":String(e):""}function L(e){const t=y.value.find(l=>l._id===e);return(t==null?void 0:t.subcat)||[]}function Y(){v.value=L(a.value.category),v.value.some(e=>e._id===a.value.subCategory)||(a.value.subCategory="")}function D(){_.value=!1,C.value="",p.value=[],$.value=[],a.value={name:"",description:"",price:"",address:"",category:"",subCategory:""}}function q(e){C.value=(e==null?void 0:e._id)||"",a.value={name:(e==null?void 0:e.name)||"",description:(e==null?void 0:e.description)||"",price:(e==null?void 0:e.price)!==void 0&&(e==null?void 0:e.price)!==null?String(e.price):"",address:(e==null?void 0:e.address)||"",category:F((e==null?void 0:e.category)||(e==null?void 0:e.mainCategory)),subCategory:F(e==null?void 0:e.subCategory)},v.value=L(a.value.category),v.value.some(t=>t._id===a.value.subCategory)||(a.value.subCategory=""),$.value=Array.isArray(e==null?void 0:e.image)?e.image:e!=null&&e.image?[e.image]:[],p.value=[],_.value=!0}function H(e){var t;p.value=Array.from(((t=e.target)==null?void 0:t.files)||[])}async function J(){var e,t,l,S,R;if(C.value){m.value=!0,n.value.show=!1;try{const c=new FormData;(e=a.value.name)!=null&&e.trim()&&c.append("name",a.value.name.trim()),(t=a.value.description)!=null&&t.trim()&&c.append("description",a.value.description.trim()),a.value.price!==""&&c.append("price",String(a.value.price)),(l=a.value.address)!=null&&l.trim()&&c.append("address",a.value.address.trim()),a.value.category&&c.append("category",a.value.category),a.value.subCategory&&c.append("subCategory",a.value.subCategory),p.value.forEach(Z=>{c.append("MultipleImage",Z)});const N=await ne(V.EDIT_PRODUCT(C.value),c),X=(N==null?void 0:N.message)||"Product updated successfully";D(),await P(),B(X)}catch(c){console.error(c),T(((R=(S=c==null?void 0:c.response)==null?void 0:S.data)==null?void 0:R.message)||"Failed to update product.")}finally{m.value=!1}}}function K(){g.value<b.value&&(g.value++,P())}function Q(){g.value>1&&(g.value--,P())}return ee(()=>{P(),G()}),(e,t)=>(o(),M(oe,null,{default:I(()=>[se(le,{pageTitle:A.value},null,8,["pageTitle"]),s("div",Ce,[t[7]||(t[7]=s("h3",{class:"mb-5 text-lg font-semibold text-gray-800 dark:text-white/90 lg:mb-7"}," Products ",-1)),n.value.show?(o(),r("div",{key:0,class:te(["rounded-lg p-4 mb-4",n.value.type==="success"?"border border-green-300 bg-green-50 text-green-700":"border border-red-300 bg-red-50 text-red-700"])},d(n.value.message),3)):f("",!0),u.value?(o(),r("div",$e,t[6]||(t[6]=[s("span",{class:"animate-spin inline-block h-10 w-10 rounded-full border-4 border-slate-300 border-t-primary"},null,-1)]))):f("",!0),u.value?f("",!0):(o(),M(we,{key:2,products:w.value,onEdit:q},null,8,["products"])),u.value?f("",!0):(o(),r("div",Pe,[s("button",{onClick:Q,disabled:g.value===1,class:"px-4 py-2 rounded border bg-gray-100 dark:bg-slate-700 disabled:opacity-40"}," Prev ",8,Se),s("span",Ie," Page "+d(g.value)+" of "+d(b.value),1),s("button",{onClick:K,disabled:g.value===b.value,class:"px-4 py-2 rounded border bg-gray-100 dark:bg-slate-700 disabled:opacity-40"}," Next ",8,Ee)]))]),_.value?(o(),M(re,{key:0,onClose:D},{title:I(()=>t[8]||(t[8]=[ae("Edit Product")])),footer:I(()=>[s("button",{onClick:D,class:"px-4 py-2 border rounded"}," Cancel "),s("button",{onClick:J,disabled:m.value,class:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-60"},d(m.value?"Saving...":"Save"),9,Re)]),default:I(()=>[s("div",Ae,[s("div",null,[t[9]||(t[9]=s("label",{class:"font-medium text-sm mb-1 block"},"Name",-1)),x(s("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.name=l),type:"text",class:"border rounded p-2 h-10 w-full",placeholder:"Product name"},null,512),[[E,a.value.name]])]),s("div",null,[t[10]||(t[10]=s("label",{class:"font-medium text-sm mb-1 block"},"Description",-1)),x(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.description=l),rows:"3",class:"border rounded p-2 w-full",placeholder:"Product description"},null,512),[[E,a.value.description]])]),s("div",Ue,[s("div",null,[t[11]||(t[11]=s("label",{class:"font-medium text-sm mb-1 block"},"Price",-1)),x(s("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.price=l),type:"number",min:"0",class:"border rounded p-2 h-10 w-full",placeholder:"0"},null,512),[[E,a.value.price]])]),s("div",null,[t[12]||(t[12]=s("label",{class:"font-medium text-sm mb-1 block"},"Address",-1)),x(s("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.address=l),type:"text",class:"border rounded p-2 h-10 w-full",placeholder:"Address"},null,512),[[E,a.value.address]])])]),s("div",Te,[s("div",null,[t[14]||(t[14]=s("label",{class:"font-medium text-sm mb-1 block"},"Category",-1)),x(s("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.category=l),onChange:Y,class:"border rounded p-2 h-10 w-full"},[t[13]||(t[13]=s("option",{value:""},"Select Category",-1)),(o(!0),r(h,null,k(y.value,l=>(o(),r("option",{key:l._id,value:l._id},d(l.name),9,De))),128))],544),[[z,a.value.category]])]),s("div",null,[t[16]||(t[16]=s("label",{class:"font-medium text-sm mb-1 block"},"Sub Category",-1)),x(s("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.subCategory=l),disabled:!a.value.category,class:"border rounded p-2 h-10 w-full disabled:opacity-60"},[t[15]||(t[15]=s("option",{value:""},"Select Sub Category",-1)),(o(!0),r(h,null,k(v.value,l=>(o(),r("option",{key:l._id,value:l._id},d(l.name),9,Me))),128))],8,Ne),[[z,a.value.subCategory]])])]),s("div",null,[t[17]||(t[17]=s("label",{class:"font-medium text-sm mb-2 block"},"Current Images",-1)),$.value.length?(o(),r("div",Ve,[(o(!0),r(h,null,k($.value,(l,S)=>(o(),r("img",{key:S,src:W(l),class:"w-14 h-14 object-cover rounded border shrink-0"},null,8,je))),128))])):(o(),r("p",Fe,"No image found."))]),s("div",null,[t[18]||(t[18]=s("label",{class:"font-medium text-sm mb-1 block"},"Replace Images",-1)),s("input",{type:"file",accept:"image/*",multiple:"",onChange:H,class:"border rounded p-2 w-full"},null,32),p.value.length?(o(),r("p",Le,d(p.value.length)+" file(s) selected. ",1)):f("",!0)])])]),_:1})):f("",!0)]),_:1}))}};export{He as default};
