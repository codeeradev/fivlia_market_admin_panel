import{r as c,k as gt,g as R,h as y,o as i,l as J,d as e,c as g,f as j,F as D,j as m,i as ct,t as l,w as x,y as P,z as yt,x as V,n as N}from"./index-CaSgO1db.js";import{_ as pt}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CywckTZI.js";import{_ as mt}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CeZA-Lw6.js";import{_ as K}from"./BaseModal-DxnqDk7L.js";import{_ as xt}from"./BaseTable.vue_vue_type_script_setup_true_lang-Cx9GC98I.js";import{g as O,E as w,b as Q,p as vt}from"./endpoint-iQ42WPj-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const bt={class:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-800 dark:bg-gray-900"},ft={class:"overflow-x-auto"},_t={class:"px-4 py-2"},kt=["src"],wt={class:"px-4 py-2"},Ct={class:"font-medium text-gray-900 dark:text-gray-100"},ht={class:"px-4 py-2"},Dt={class:"text-sm text-gray-900 dark:text-gray-100"},Nt={class:"text-xs text-gray-500 dark:text-gray-400"},At={class:"px-4 py-2"},It={class:"px-4 py-2"},St=["onClick"],Tt={class:"px-4 py-2 text-center"},jt={class:"flex items-center justify-center gap-2"},Bt=["onClick"],Et=["onClick"],$t={key:0,class:"py-10 text-center text-gray-500"},Mt={class:"grid grid-cols-1 gap-4"},Lt={key:0,class:"flex items-center gap-2"},Ut=["value"],Ft=["value"],Rt=["value"],Pt=["src"],Vt={class:"flex flex-wrap items-center gap-2"},Ot={class:"max-h-[68vh] space-y-4 overflow-y-auto pr-1"},zt={class:"overflow-hidden rounded-2xl border border-gray-200 dark:border-gray-700"},Gt={class:"grid grid-cols-1 lg:grid-cols-[230px_minmax(0,1fr)]"},Yt=["src"],qt={class:"bg-gradient-to-br from-gray-50 to-white p-4 dark:from-gray-900/40 dark:to-gray-900"},Ht={class:"flex flex-wrap items-start justify-between gap-3"},Wt={class:"min-w-0"},Jt={class:"truncate text-xl font-semibold text-gray-900 dark:text-gray-100"},Kt={class:"mt-1 text-sm text-gray-600 dark:text-gray-300"},Qt={class:"text-sm text-gray-500 dark:text-gray-400"},Xt={class:"flex flex-wrap gap-2"},Zt={class:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-3"},te={class:"rounded-xl border border-gray-200 bg-white p-3 dark:border-gray-700 dark:bg-gray-900/50"},ee={class:"mt-1 font-semibold text-gray-900 dark:text-gray-100"},ae={class:"rounded-xl border border-gray-200 bg-white p-3 dark:border-gray-700 dark:bg-gray-900/50"},se={class:"mt-1 font-semibold text-gray-900 dark:text-gray-100"},re={class:"rounded-xl border border-gray-200 bg-white p-3 dark:border-gray-700 dark:bg-gray-900/50"},oe={class:"mt-1 font-semibold text-gray-900 dark:text-gray-100"},le={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ne={class:"rounded-xl border border-gray-200 p-4 dark:border-gray-700"},de={class:"space-y-1 text-sm"},ie={class:"flex items-center justify-between gap-3 border-b border-gray-100 py-2 dark:border-gray-800"},ue={class:"font-medium text-gray-900 dark:text-gray-100"},ge={class:"flex items-center justify-between gap-3 border-b border-gray-100 py-2 dark:border-gray-800"},ce={class:"font-medium text-gray-900 dark:text-gray-100"},ye={class:"flex items-center justify-between gap-3 py-2"},pe={class:"font-medium text-gray-900 dark:text-gray-100"},me={class:"rounded-xl border border-gray-200 p-4 dark:border-gray-700"},xe={class:"space-y-1 text-sm"},ve={class:"flex items-center justify-between gap-3 border-b border-gray-100 py-2 dark:border-gray-800"},be={class:"font-medium text-gray-900 dark:text-gray-100"},fe={class:"flex items-center justify-between gap-3 py-2"},_e={class:"font-medium text-gray-900 dark:text-gray-100"},ke={class:"rounded-xl border border-gray-200 p-4 dark:border-gray-700 md:col-span-2"},we={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ce={class:"space-y-1 text-sm"},he={class:"flex items-center justify-between gap-3 border-b border-gray-100 py-2 dark:border-gray-800"},De={class:"break-all text-right font-medium text-gray-900 dark:text-gray-100"},Ne={class:"flex items-center justify-between gap-3 border-b border-gray-100 py-2 dark:border-gray-800"},Ae={class:"font-medium text-gray-900 dark:text-gray-100"},Ie={class:"flex items-center justify-between gap-3 py-2"},Se={class:"font-medium text-gray-900 dark:text-gray-100"},Te={class:"space-y-1 text-sm"},je={class:"flex items-center justify-between gap-3 border-b border-gray-100 py-2 dark:border-gray-800"},Be={class:"font-medium text-gray-900 dark:text-gray-100"},Ee={class:"flex items-center justify-between gap-3 border-b border-gray-100 py-2 dark:border-gray-800"},$e={class:"font-medium text-gray-900 dark:text-gray-100"},Me={class:"flex items-center justify-between gap-3 py-2"},Le={class:"font-medium text-gray-900 dark:text-gray-100"},Ue={key:0,class:"rounded-xl border border-red-200 bg-red-50 p-4 dark:border-red-900 dark:bg-red-950/30"},Fe={class:"mt-1 text-sm text-red-700 dark:text-red-300"},He={__name:"BannersList",setup(Re){const A=c([]),v=c([]),B=c([]),I=c([]),b=c(!1),E=c(!1),f=c(!1),$=c(""),o=c(null),S=c(null),C=c(""),r=c({title:"",status:!0,mainCategory:"",subCategory:"",cityId:"",fromDate:"",toDate:""}),X="https://fivliaproject.s3.eu-north-1.amazonaws.com",M=a=>{if(!a)return"/no-image.png";if(/^https?:\/\//i.test(a))return a;const t=X.replace(/\/+$/,""),s=a.startsWith("/")?a:`/${a}`;return`${t}${s}`},z=a=>{const t=String(a||"pending").toLowerCase();return t==="active"?"bg-green-100 text-green-700":t==="rejected"?"bg-red-100 text-red-700":t==="resubmit"?"bg-orange-100 text-orange-700":t==="expired"?"bg-gray-200 text-gray-700":"bg-yellow-100 text-yellow-700"},G=a=>{const t=String(a||"").replace(/[_-]+/g," ").trim();return t?t.charAt(0).toUpperCase()+t.slice(1):"-"},h=a=>{if(!a)return"-";const t=new Date(a);return Number.isNaN(t.getTime())?"-":t.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},Z=a=>{if(a==null||a==="")return"-";const t=Number(a);return Number.isNaN(t)?String(a):`Rs ${t.toLocaleString("en-IN")}`},_=a=>a?typeof a=="string"?a:String((a==null?void 0:a._id)||(a==null?void 0:a.id)||""):"",L=(a,t)=>{if(!a)return"-";if(typeof a=="object"&&a.name)return a.name;const s=_(a);if(!s)return"-";const n=_(t);let u=[];if(n){const d=v.value.find(k=>_(k)===n);u=Array.isArray(d==null?void 0:d.subcat)?d.subcat:[]}u.length||(u=v.value.flatMap(d=>Array.isArray(d==null?void 0:d.subcat)?d.subcat:[]));const p=u.find(d=>_(d)===s);return(p==null?void 0:p.name)||"-"},U=a=>{if(!a)return"-";if(typeof a=="object")return a.city||a.name||"-";const t=_(a);if(!t)return"-";const s=I.value.find(n=>_(n)===t);return(s==null?void 0:s.city)||(s==null?void 0:s.name)||"-"},Y=a=>{const t=Date.parse((a==null?void 0:a.fromDate)||""),s=Date.parse((a==null?void 0:a.toDate)||"");if(Number.isNaN(t)||Number.isNaN(s))return"No schedule";const n=Date.now();return n<t?"Scheduled":n>s?"Expired":"Running"},tt=a=>{const t=Y(a);return t==="Running"?"bg-green-100 text-green-700":t==="Scheduled"?"bg-blue-100 text-blue-700":t==="Expired"?"bg-gray-200 text-gray-700":"bg-yellow-100 text-yellow-700"},et=a=>{o.value=a,E.value=!0},T=()=>{E.value=!1,o.value=null},at=()=>{if(!o.value)return;const a=o.value;T(),W(a)};gt(async()=>{await Promise.all([F(),st(),rt()])});const F=async()=>{try{const a=await O(w.GET_BANNERS);A.value=Array.isArray(a)?a:(a==null?void 0:a.banners)||[]}catch(a){console.error(a),A.value=[]}},st=async()=>{try{const a=await O(w.CATEGORY.GET_ALL);v.value=Array.isArray(a==null?void 0:a.categories)?a.categories:[]}catch(a){console.error(a),v.value=[]}},rt=async()=>{try{const a=await O(w.GET_CITY);I.value=Array.isArray(a)?a:(a==null?void 0:a.data)||(a==null?void 0:a.cities)||[]}catch(a){console.error(a),I.value=[]}},q=()=>{const a=v.value.find(t=>t._id===r.value.mainCategory);B.value=a?a.subcat||[]:[]},ot=()=>{S.value=null,C.value="",B.value=[],r.value={title:"",status:!0,mainCategory:"",subCategory:"",cityId:"",fromDate:"",toDate:""}},lt=()=>{f.value=!1,$.value="",ot(),b.value=!0},H=a=>{if(!a)return"";const t=new Date(a);if(Number.isNaN(t.getTime()))return"";const s=ut=>String(ut).padStart(2,"0"),n=t.getFullYear(),u=s(t.getMonth()+1),p=s(t.getDate()),d=s(t.getHours()),k=s(t.getMinutes());return`${n}-${u}-${p}T${d}:${k}`},W=a=>{var t,s,n;T(),f.value=!0,$.value=a._id,r.value.title=a.title||"",r.value.status=!!a.status,r.value.mainCategory=((t=a.mainCategory)==null?void 0:t._id)||"",r.value.subCategory=((s=a.subCategory)==null?void 0:s._id)||"",r.value.cityId=((n=a.cityId)==null?void 0:n._id)||a.cityId||"",r.value.fromDate=H(a.fromDate),r.value.toDate=H(a.toDate),C.value=M(a.image),q(),b.value=!0},nt=a=>{var s;const t=(s=a.target.files)==null?void 0:s[0];t&&(S.value=t,C.value=URL.createObjectURL(t))},dt=async()=>{var a,t;try{const s=new FormData;if(S.value&&s.append("image",S.value),f.value)s.append("title",r.value.title||""),s.append("status",String(!!r.value.status)),r.value.mainCategory&&s.append("mainCategory",r.value.mainCategory),r.value.subCategory&&s.append("subCategory",r.value.subCategory),await Q(w.UPDATE_BANNER($.value),s);else{if(!r.value.mainCategory){alert("Main category is required");return}if(!r.value.fromDate||!r.value.toDate){alert("From Date and To Date are required");return}const n=new Date(r.value.fromDate),u=new Date(r.value.toDate);if(Number.isNaN(n.getTime())||Number.isNaN(u.getTime())){alert("Please provide valid From Date and To Date");return}s.append("title",r.value.title||""),s.append("mainCategory",r.value.mainCategory),r.value.subCategory&&s.append("subCategory",r.value.subCategory),r.value.cityId&&s.append("cityId",r.value.cityId),s.append("fromDate",n.toISOString()),s.append("toDate",u.toISOString()),await vt(w.ADD_ADMIN_BANNER,s)}b.value=!1,await F()}catch(s){console.error(s),alert(((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to save banner")}},it=async a=>{var t,s;try{await Q(w.UPDATE_BANNER(a._id),{status:!a.status}),await F()}catch(n){console.error(n),alert(((s=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to update banner status")}};return(a,t)=>(i(),R(pt,null,{default:y(()=>[J(mt,{pageTitle:"Banners"}),e("div",bt,[e("div",{class:"mb-6 flex items-center justify-between"},[t[9]||(t[9]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Banners",-1)),e("button",{onClick:lt,class:"rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700"}," + Add Banner ")]),e("div",ft,[J(xt,null,{head:y(()=>t[10]||(t[10]=[e("th",{class:"px-4 py-2"},"Image",-1),e("th",{class:"px-4 py-2"},"Title",-1),e("th",{class:"px-4 py-2"},"Category",-1),e("th",{class:"px-4 py-2"},"Approval",-1),e("th",{class:"px-4 py-2"},"Active",-1),e("th",{class:"px-4 py-2 text-center"},"Actions",-1)])),body:y(()=>[(i(!0),g(D,null,j(A.value,s=>{var n;return i(),g("tr",{key:s._id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",_t,[e("img",{src:M(s.image),class:"h-10 w-20 rounded-md object-cover"},null,8,kt)]),e("td",wt,[e("div",Ct,l(s.title||"-"),1)]),e("td",ht,[e("div",Dt,l(((n=s.mainCategory)==null?void 0:n.name)||"-"),1),e("div",Nt,l(L(s.subCategory,s.mainCategory))+" | "+l(U(s.cityId)),1)]),e("td",At,[e("span",{class:N(["rounded px-2 py-1 text-xs",z(s.aprroveStatus)])},l(G(s.aprroveStatus||"pending")),3)]),e("td",It,[e("button",{onClick:u=>it(s),class:N(["rounded px-2 py-1 text-xs text-white",s.status?"bg-green-600":"bg-red-600"])},l(s.status?"Active":"Inactive"),11,St)]),e("td",Tt,[e("div",jt,[e("button",{onClick:u=>et(s),class:"rounded bg-blue-600 px-2 py-1 text-xs text-white hover:bg-blue-700"}," View ",8,Bt),e("button",{onClick:u=>W(s),class:"rounded bg-yellow-500 px-2 py-1 text-xs text-white"}," Edit ",8,Et)])])])}),128))]),_:1})]),A.value.length===0?(i(),g("div",$t,"No banners found")):m("",!0)]),b.value?(i(),R(K,{key:0,onClose:t[8]||(t[8]=s=>b.value=!1)},{title:y(()=>[ct(l(f.value?"Edit Banner":"Add Banner"),1)]),footer:y(()=>[e("button",{onClick:t[7]||(t[7]=s=>b.value=!1),class:"rounded border px-4 py-2"},"Cancel"),e("button",{onClick:dt,class:"rounded bg-blue-600 px-4 py-2 text-white"},"Save")]),default:y(()=>[e("div",Mt,[e("div",null,[t[11]||(t[11]=e("label",{class:"mb-1 block text-sm font-medium"},"Title",-1)),x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.value.title=s),class:"h-10 w-full rounded border p-2"},null,512),[[P,r.value.title]])]),f.value?(i(),g("div",Lt,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=s=>r.value.status=s)},null,512),[[yt,r.value.status]]),t[12]||(t[12]=e("label",{class:"text-sm font-medium"},"Active status",-1))])):m("",!0),e("div",null,[t[14]||(t[14]=e("label",{class:"mb-1 block text-sm font-medium"},"Main Category",-1)),x(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.mainCategory=s),onChange:q,class:"h-10 w-full rounded border p-2"},[t[13]||(t[13]=e("option",{value:""},"Select Category",-1)),(i(!0),g(D,null,j(v.value,s=>(i(),g("option",{key:s._id,value:s._id},l(s.name),9,Ut))),128))],544),[[V,r.value.mainCategory]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"mb-1 block text-sm font-medium"},"Sub Category",-1)),x(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.subCategory=s),class:"h-10 w-full rounded border p-2"},[t[15]||(t[15]=e("option",{value:""},"Select Sub Category",-1)),(i(!0),g(D,null,j(B.value,s=>(i(),g("option",{key:s._id,value:s._id},l(s.name),9,Ft))),128))],512),[[V,r.value.subCategory]])]),f.value?m("",!0):(i(),g(D,{key:1},[e("div",null,[t[18]||(t[18]=e("label",{class:"mb-1 block text-sm font-medium"},"City (optional)",-1)),x(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>r.value.cityId=s),class:"h-10 w-full rounded border p-2"},[t[17]||(t[17]=e("option",{value:""},"Select City",-1)),(i(!0),g(D,null,j(I.value,s=>(i(),g("option",{key:s._id,value:s._id},l(s.city||s.name),9,Rt))),128))],512),[[V,r.value.cityId]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"mb-1 block text-sm font-medium"},"From Date",-1)),x(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>r.value.fromDate=s),type:"datetime-local",class:"h-10 w-full rounded border p-2"},null,512),[[P,r.value.fromDate]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"mb-1 block text-sm font-medium"},"To Date",-1)),x(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>r.value.toDate=s),type:"datetime-local",class:"h-10 w-full rounded border p-2"},null,512),[[P,r.value.toDate]])])],64)),e("div",null,[t[21]||(t[21]=e("label",{class:"mb-1 block text-sm font-medium"},"Image",-1)),e("input",{type:"file",onChange:nt,class:"h-10 w-full rounded border p-2"},null,32),C.value?(i(),g("img",{key:0,src:C.value,class:"mt-2 h-24 w-48 rounded border object-cover"},null,8,Pt)):m("",!0)])])]),_:1})):m("",!0),E.value&&o.value?(i(),R(K,{key:1,onClose:T},{title:y(()=>[e("div",Vt,[t[22]||(t[22]=e("span",{class:"text-base font-semibold text-gray-900 dark:text-gray-100"},"Banner Details",-1)),e("span",{class:N(["rounded-full px-2 py-1 text-xs",tt(o.value)])},l(Y(o.value)),3)])]),footer:y(()=>[e("button",{onClick:T,class:"rounded border px-4 py-2"},"Close"),e("button",{onClick:at,class:"rounded bg-yellow-500 px-4 py-2 text-white"},"Edit Banner")]),default:y(()=>{var s,n,u,p,d,k;return[e("div",Ot,[e("div",zt,[e("div",Gt,[e("img",{src:M(o.value.image),class:"h-44 w-full object-cover lg:h-full",alt:"Banner image"},null,8,Yt),e("div",qt,[e("div",Ht,[e("div",Wt,[e("h3",Jt,l(o.value.title||"-"),1),e("p",Kt,l(((s=o.value.mainCategory)==null?void 0:s.name)||"-")+" / "+l(L(o.value.subCategory,o.value.mainCategory)),1),e("p",Qt,"City: "+l(U(o.value.cityId)),1)]),e("div",Xt,[e("span",{class:N(["rounded-full px-2 py-1 text-xs",z(o.value.aprroveStatus)])},l(G(o.value.aprroveStatus||"pending")),3),e("span",{class:N(["rounded-full px-2 py-1 text-xs",o.value.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},l(o.value.status?"Active":"Inactive"),3)])]),e("div",Zt,[e("div",te,[t[23]||(t[23]=e("p",{class:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400"},"Plan",-1)),e("p",ee,l(((n=o.value.selectedPlanId)==null?void 0:n.duration)||"-"),1)]),e("div",ae,[t[24]||(t[24]=e("p",{class:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400"},"Price",-1)),e("p",se,l(Z((u=o.value.selectedPlanId)==null?void 0:u.price)),1)]),e("div",re,[t[25]||(t[25]=e("p",{class:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400"},"Type",-1)),e("p",oe,l(o.value.type||"-"),1)])])])])]),e("div",le,[e("div",ne,[t[29]||(t[29]=e("h4",{class:"mb-2 text-sm font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400"},"Banner Info",-1)),e("div",de,[e("div",ie,[t[26]||(t[26]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Main Category",-1)),e("span",ue,l(((p=o.value.mainCategory)==null?void 0:p.name)||"-"),1)]),e("div",ge,[t[27]||(t[27]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Sub Category",-1)),e("span",ce,l(L(o.value.subCategory,o.value.mainCategory)),1)]),e("div",ye,[t[28]||(t[28]=e("span",{class:"text-gray-500 dark:text-gray-400"},"City",-1)),e("span",pe,l(U(o.value.cityId)),1)])])]),e("div",me,[t[32]||(t[32]=e("h4",{class:"mb-2 text-sm font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400"},"Owner Info",-1)),e("div",xe,[e("div",ve,[t[30]||(t[30]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Name",-1)),e("span",be,l(((d=o.value.userId)==null?void 0:d.name)||"-"),1)]),e("div",fe,[t[31]||(t[31]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Mobile",-1)),e("span",_e,l(((k=o.value.userId)==null?void 0:k.mobileNumber)||"-"),1)])])]),e("div",ke,[t[39]||(t[39]=e("h4",{class:"mb-2 text-sm font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400"},"Payment & Timeline",-1)),e("div",we,[e("div",Ce,[e("div",he,[t[33]||(t[33]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Transaction ID",-1)),e("span",De,l(o.value.transactionId||"-"),1)]),e("div",Ne,[t[34]||(t[34]=e("span",{class:"text-gray-500 dark:text-gray-400"},"From Date",-1)),e("span",Ae,l(h(o.value.fromDate)),1)]),e("div",Ie,[t[35]||(t[35]=e("span",{class:"text-gray-500 dark:text-gray-400"},"To Date",-1)),e("span",Se,l(h(o.value.toDate)),1)])]),e("div",Te,[e("div",je,[t[36]||(t[36]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Approved At",-1)),e("span",Be,l(h(o.value.approvedAt)),1)]),e("div",Ee,[t[37]||(t[37]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Created At",-1)),e("span",$e,l(h(o.value.createdAt)),1)]),e("div",Me,[t[38]||(t[38]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Updated At",-1)),e("span",Le,l(h(o.value.updatedAt)),1)])])])])]),o.value.approvalReason?(i(),g("div",Ue,[t[40]||(t[40]=e("p",{class:"text-sm font-semibold text-red-700 dark:text-red-300"},"Approval Reason",-1)),e("p",Fe,l(o.value.approvalReason),1)])):m("",!0)])]}),_:1})):m("",!0)]),_:1}))}};export{He as default};
