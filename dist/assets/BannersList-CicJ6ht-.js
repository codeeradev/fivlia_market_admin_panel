import{r as i,k as Q,g as $,h as c,o,l as M,d as a,c as n,f as D,F as _,j as g,i as V,t as d,w as m,y as I,x as w,z as W,n as X}from"./index-DRCwg4EZ.js";import{_ as Z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Bdc2VVU4.js";import{_ as ee}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-T41Zm9iO.js";import{_ as te}from"./BaseModal-DiLMXNfp.js";import{_ as ae}from"./BaseTable.vue_vue_type_script_setup_true_lang-wmfEEMhB.js";import{g as S,E as p,b as F,p as se,d as le}from"./endpoint-CWNBtn7N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"p-6 bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800"},ne={class:"overflow-x-auto"},re={class:"px-4 py-2"},ue=["src"],ie={class:"px-4 py-2 font-medium"},de={class:"px-4 py-2"},me={class:"px-4 py-2"},pe={key:0},ve={class:"px-4 py-2 text-center"},ye=["onClick"],ce={class:"px-4 py-2 text-center space-x-2"},ge=["onClick"],fe=["onClick"],be={key:0,class:"text-center py-10 text-gray-500"},xe={class:"grid grid-cols-1 gap-4"},Ce={class:"flex items-center gap-2 mt-1"},De=["value"],_e=["value"],we=["value"],ke={key:0},Ne={key:1},Te=["src"],Me={__name:"BannersList",setup(Ie){const k=i([]),N=i([]),A=i([]),E=i([]),v=i(!1),y=i(!1),T=i(""),b=i(null),f=i(""),l=i({title:"",status:!0,type:"normal",mainCategory:"",subCategory:"",cityId:"",fromDate:"",toDate:""}),L="https://fivliaproject.s3.eu-north-1.amazonaws.com",B=s=>s?L+s:"/no-image.png";Q(()=>{x(),R(),O()});const x=async()=>{const s=await S(p.GET_BANNERS);k.value=s.banners||s},R=async()=>{const s=await S(p.CATEGORY.GET_ALL);N.value=s.categories||[]},O=async()=>{const s=await S(p.GET_CITY);E.value=Array.isArray(s)?s:(s==null?void 0:s.data)||(s==null?void 0:s.cities)||[]},h=()=>{const s=N.value.find(t=>t._id===l.value.mainCategory);A.value=s?s.subcat:[]},j=()=>{y.value=!1,T.value="",b.value=null,f.value="",l.value={title:"",status:!0,type:"normal",mainCategory:"",subCategory:"",cityId:"",fromDate:"",toDate:""},v.value=!0},U=s=>{if(!s)return"";const t=new Date(s);if(Number.isNaN(t.getTime()))return"";const e=K=>String(K).padStart(2,"0"),r=t.getFullYear(),u=e(t.getMonth()+1),C=e(t.getDate()),H=e(t.getHours()),J=e(t.getMinutes());return`${r}-${u}-${C}T${H}:${J}`},G=s=>{var t,e,r,u;y.value=!0,T.value=s._id,l.value.title=s.title,l.value.status=s.status,l.value.type=s.type,l.value.mainCategory=((t=s.mainCategory)==null?void 0:t._id)||"",l.value.subCategory=((e=s.subCategory)==null?void 0:e._id)||"",l.value.cityId=((r=s.cityId)==null?void 0:r._id)||s.cityId||(Array.isArray(s.city)&&s.city.length?((u=s.city[0])==null?void 0:u._id)||s.city[0]:"")||"",l.value.fromDate=U(s.fromDate),l.value.toDate=U(s.toDate),f.value=B(s.image),h(),v.value=!0},P=s=>{var e;const t=(e=s.target.files)==null?void 0:e[0];t&&(b.value=t,f.value=URL.createObjectURL(t))},z=async()=>{var s,t;try{const e=new FormData;if(b.value&&e.append("image",b.value),y.value)e.append("title",l.value.title),e.append("status",String(l.value.status)),e.append("type2",l.value.type),e.append("mainCategory",l.value.mainCategory),l.value.subCategory&&e.append("subCategory",l.value.subCategory),l.value.cityId&&e.append("city",JSON.stringify([l.value.cityId])),await F(p.UPDATE_BANNER(T.value),e);else{if(!l.value.mainCategory){alert("Main category is required");return}if(!l.value.fromDate||!l.value.toDate){alert("From Date and To Date are required");return}const r=new Date(l.value.fromDate),u=new Date(l.value.toDate);if(Number.isNaN(r.getTime())||Number.isNaN(u.getTime())){alert("Please provide valid From Date and To Date");return}e.append("title",l.value.title),e.append("mainCategory",l.value.mainCategory),l.value.subCategory&&e.append("subCategory",l.value.subCategory),l.value.cityId&&e.append("cityId",l.value.cityId),e.append("fromDate",r.toISOString()),e.append("toDate",u.toISOString()),await se(p.ADD_ADMIN_BANNER,e)}v.value=!1,await x()}catch(e){console.error(e),alert(((t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to save banner")}},Y=async s=>{await F(p.UPDATE_BANNER(s._id),{status:!s.status}),x()},q=async s=>{confirm("Delete?")&&(await le(p.DELETE_BANNER(s)),x())};return(s,t)=>(o(),$(Z,null,{default:c(()=>[M(ee,{pageTitle:"Banners"}),a("div",oe,[a("div",{class:"flex justify-between items-center mb-6"},[t[10]||(t[10]=a("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"}," Banners ",-1)),a("button",{onClick:j,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg"}," + Add Banner ")]),a("div",ne,[M(ae,null,{head:c(()=>t[11]||(t[11]=[a("th",{class:"px-4 py-2"},"Image",-1),a("th",{class:"px-4 py-2"},"Title",-1),a("th",{class:"px-4 py-2"},"Type",-1),a("th",{class:"px-4 py-2"},"Category",-1),a("th",{class:"px-4 py-2 text-center"},"Status",-1),a("th",{class:"px-4 py-2 text-center"},"Actions",-1)])),body:c(()=>[(o(!0),n(_,null,D(k.value,e=>{var r,u;return o(),n("tr",{key:e._id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[a("td",re,[a("img",{src:B(e.image),class:"h-10 w-20 rounded-md object-cover"},null,8,ue)]),a("td",ie,d(e.title),1),a("td",de,d(e.type),1),a("td",me,[V(d((r=e.mainCategory)==null?void 0:r.name)+" ",1),e.subCategory?(o(),n("span",pe," / "+d((u=e.subCategory)==null?void 0:u.name),1)):g("",!0)]),a("td",ve,[a("button",{onClick:C=>Y(e),class:X(["px-2 py-1 text-xs text-white rounded",e.status?"bg-green-500":"bg-red-500"])},d(e.status?"Active":"Inactive"),11,ye)]),a("td",ce,[a("button",{onClick:C=>G(e),class:"px-2 py-1 bg-yellow-500 text-white rounded text-xs"}," Edit ",8,ge),a("button",{onClick:C=>q(e._id),class:"px-2 py-1 bg-red-600 text-white rounded text-xs"}," Delete ",8,fe)])])}),128))]),_:1})]),k.value.length===0?(o(),n("div",be," No banners found ")):g("",!0)]),v.value?(o(),$(te,{key:0,onClose:t[9]||(t[9]=e=>v.value=!1)},{title:c(()=>[V(d(y.value?"Edit Banner":"Add Banner"),1)]),footer:c(()=>[a("button",{onClick:t[8]||(t[8]=e=>v.value=!1),class:"px-4 py-2 border rounded"}," Cancel "),a("button",{onClick:z,class:"px-4 py-2 bg-blue-600 text-white rounded"}," Save ")]),default:c(()=>[a("div",xe,[a("div",null,[t[12]||(t[12]=a("label",{class:"font-medium text-sm mb-1"},"Title",-1)),m(a("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.title=e),class:"border rounded p-2 h-10 w-full"},null,512),[[I,l.value.title]])]),a("div",null,[t[14]||(t[14]=a("label",{class:"font-medium text-sm mb-1"},"Type",-1)),m(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.type=e),class:"border rounded p-2 h-10 w-full"},t[13]||(t[13]=[a("option",{value:"normal"},"Normal",-1),a("option",{value:"offer"},"Offer",-1)]),512),[[w,l.value.type]])]),a("div",Ce,[m(a("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>l.value.status=e)},null,512),[[W,l.value.status]]),t[15]||(t[15]=a("label",{class:"font-medium text-sm"},"Status",-1))]),a("div",null,[t[17]||(t[17]=a("label",{class:"font-medium text-sm mb-1"},"Main Category",-1)),m(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.mainCategory=e),onChange:h,class:"border rounded p-2 h-10 w-full"},[t[16]||(t[16]=a("option",{value:""},"Select Category",-1)),(o(!0),n(_,null,D(N.value,e=>(o(),n("option",{key:e._id,value:e._id},d(e.name),9,De))),128))],544),[[w,l.value.mainCategory]])]),a("div",null,[t[19]||(t[19]=a("label",{class:"font-medium text-sm mb-1"},"Sub Category",-1)),m(a("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.subCategory=e),class:"border rounded p-2 h-10 w-full"},[t[18]||(t[18]=a("option",{value:""},"Select Sub Category",-1)),(o(!0),n(_,null,D(A.value,e=>(o(),n("option",{key:e._id,value:e._id},d(e.name),9,_e))),128))],512),[[w,l.value.subCategory]])]),a("div",null,[t[21]||(t[21]=a("label",{class:"font-medium text-sm mb-1"},"City",-1)),m(a("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.cityId=e),class:"border rounded p-2 h-10 w-full"},[t[20]||(t[20]=a("option",{value:""},"Select City",-1)),(o(!0),n(_,null,D(E.value,e=>(o(),n("option",{key:e._id,value:e._id},d(e.city||e.name),9,we))),128))],512),[[w,l.value.cityId]])]),y.value?g("",!0):(o(),n("div",ke,[t[22]||(t[22]=a("label",{class:"font-medium text-sm mb-1"},"From Date",-1)),m(a("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.fromDate=e),type:"datetime-local",class:"border rounded p-2 h-10 w-full"},null,512),[[I,l.value.fromDate]])])),y.value?g("",!0):(o(),n("div",Ne,[t[23]||(t[23]=a("label",{class:"font-medium text-sm mb-1"},"To Date",-1)),m(a("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.toDate=e),type:"datetime-local",class:"border rounded p-2 h-10 w-full"},null,512),[[I,l.value.toDate]])])),a("div",null,[t[24]||(t[24]=a("label",{class:"font-medium text-sm mb-1"},"Image",-1)),a("input",{type:"file",onChange:P,class:"border rounded p-2 h-10 w-full"},null,32),f.value?(o(),n("img",{key:0,src:f.value,class:"h-24 w-48 object-cover rounded border mt-2"},null,8,Te)):g("",!0)])])]),_:1})):g("",!0)]),_:1}))}};export{Me as default};
