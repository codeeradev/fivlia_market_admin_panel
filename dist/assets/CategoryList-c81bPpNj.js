import{o as r,c as i,d as e,e as Y,i as h,j as p,p as oe,r as u,s as re,k as ie,g as X,h as L,l as ne,t as d,n as U,F as V,f as I,w as b,v as j,x as H,y as D}from"./index-CaSgO1db.js";import{_ as de}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CywckTZI.js";import{_ as ue}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CeZA-Lw6.js";import{g as K,E as T,p as B,d as ce,a as pe}from"./endpoint-iQ42WPj-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"fixed inset-0 z-[99999] flex items-center justify-center"},ge={class:"relative z-10 w-full max-w-lg mx-auto bg-white dark:bg-gray-900 rounded-xl shadow-lg overflow-hidden"},me={class:"flex justify-between items-center px-5 py-3 border-b dark:border-gray-700"},ye={class:"text-lg font-semibold text-gray-800 dark:text-gray-100"},be={class:"px-5 py-4 max-h-[70vh] overflow-y-auto"},xe={key:0,class:"px-5 py-3 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-800"},fe={__name:"Modal",emits:["close"],setup(Q){return(_,v)=>(r(),i("div",ve,[e("div",{class:"fixed inset-0 bg-gray-800/60 backdrop-blur-sm",onClick:v[0]||(v[0]=E=>_.$emit("close"))}),e("div",ge,[e("div",me,[e("h3",ye,[Y(_.$slots,"title",{},()=>[v[2]||(v[2]=h("Modal Title"))])]),e("button",{onClick:v[1]||(v[1]=E=>_.$emit("close")),class:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}," ✕ ")]),e("div",be,[Y(_.$slots,"default")]),_.$slots.footer?(r(),i("div",xe,[Y(_.$slots,"footer")])):p("",!0)])]))}},_e={class:"p-6 bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800"},he={class:"flex justify-between items-center mb-6"},ke={class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},Ce={key:0,class:"text-xs text-gray-500"},we={class:"flex gap-2"},Se={class:"overflow-x-auto"},$e={class:"min-w-full text-left border border-gray-200 dark:border-gray-700 rounded-lg"},Te={class:"bg-gray-100 dark:bg-gray-800 text-sm"},Ee={key:0},Ae={key:1},Ne={key:0},Ue={class:"px-4 py-2"},Ve=["src"],Ie={class:"px-4 py-2 font-medium"},je={class:"px-4 py-2 text-sm text-gray-500"},Me={class:"px-4 py-2 text-center"},Oe=["onClick"],Le={class:"px-4 py-2 text-center"},De=["onClick"],Ge={class:"px-4 py-2 text-center space-x-2"},Pe=["onClick"],Re=["onClick"],Ye={key:1},Be={class:"px-4 py-2"},ze=["src"],Fe={class:"px-4 py-2 font-medium"},Je={class:"px-4 py-2"},We={class:"px-4 py-2 text-center"},qe=["onClick"],Xe={class:"px-4 py-2 text-center space-x-2"},He=["onClick"],Ke=["onClick"],Qe={key:0},Ze={key:0,class:"text-center py-10 text-gray-500"},et={class:"space-y-4"},tt={key:0,class:"flex items-center gap-4"},st={class:"flex items-center gap-1 text-sm"},at={class:"flex items-center gap-1 text-sm"},lt={key:1,class:"flex items-center gap-6 mt-2"},ot={class:"flex items-center gap-1 text-sm"},rt={class:"flex items-center gap-1 text-sm"},it={class:"flex items-center gap-1 text-sm"},nt=["onUpdate:modelValue"],dt=["value"],ut=["onUpdate:modelValue"],ct=["onClick"],pt={key:2},vt=["value"],gt={class:"block mb-1 text-sm font-medium"},mt={key:0,class:"mt-2"},yt=["src"],bt={class:"flex items-center gap-2"},xt={class:"flex justify-end gap-2"},ft=["disabled"],_t={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},$t=oe({__name:"CategoryList",setup(Q){const _="https://fivliaproject.s3.eu-north-1.amazonaws.com",v=u([]),E=u(!1),G=u(null),n=u(null),m=u("categories"),c=u("main"),x=u(""),s=re({id:"",name:"",description:"",image:"",status:!0,attribute:[],type:"products"}),k=u(""),C=u(null),w=u(""),z=u([]),A=u([]),S=u(!1),$=u(""),N=u("success"),M=l=>l?l.startsWith("http")||l.startsWith("blob:")?l:`${_}/${l.replace(/^\//,"")}`:"/no-image.png",O=async()=>{try{const l=await K(T.CATEGORY.GET_ALL);if(v.value=(l==null?void 0:l.categories)||[],m.value==="subcategories"&&n.value){const t=v.value.find(o=>{var f;return o._id===((f=n.value)==null?void 0:f._id)});t?n.value=t:(m.value="categories",n.value=null)}}catch(l){console.error("Error loading categories:",l)}},Z=async()=>{try{const l=await K(T.GET_CITY);z.value=l||[]}catch(l){console.error("Failed loading cities",l)}},ee=l=>{n.value=l,m.value="subcategories"},te=()=>{m.value="categories",n.value=null},P=(l="main",t=null,o)=>{var f;if(E.value=!0,t){c.value="main",G.value=t,s.id=t._id||"",s.name=t.name||"",s.description=t.description||"",s.image=t.image||"",s.status=t.status??!0,s.attribute=t.attribute||[],s.type=t.type||"products",k.value=s.attribute.join(", "),C.value=null,w.value=s.image?M(s.image):"",x.value="";return}c.value=l,G.value=null,s.id="",s.name="",s.description="",s.image="",s.status=!0,s.attribute=[],k.value="",C.value=null,w.value="",l==="sub"?x.value=o||((f=n.value)==null?void 0:f._id)||"":x.value="",t?A.value=JSON.parse(JSON.stringify(t.city??[])):A.value=[]},R=()=>{E.value=!1,G.value=null,s.id="",s.name="",s.description="",s.image="",s.status=!0,s.attribute=[],k.value="",C.value=null,w.value="",c.value="main",x.value=""},se=l=>{var o;const t=(o=l.target.files)==null?void 0:o[0];t&&(C.value=t,w.value=URL.createObjectURL(t))},ae=async()=>{var l,t;if(!s.name.trim()){$.value="Name is required",N.value="error";return}S.value=!0,$.value="";try{s.attribute=k.value.split(",").map(f=>f.trim()).filter(Boolean);const o=new FormData;if(o.append("name",s.name),o.append("description",s.description),o.append("status",String(s.status)),o.append("city",JSON.stringify(A.value)),o.append("attribute",JSON.stringify(s.attribute)),o.append("type",s.type),C.value?o.append("image",C.value):s.image&&o.append("image",s.image),c.value==="main")s.id&&o.append("id",s.id),await B(T.CATEGORY.SAVE,o);else{if(!x.value){$.value="Please select parent category",N.value="error",S.value=!1;return}s.id?await B(T.CATEGORY.SAVE_SUB_ENTITY(x.value,s.id),o):await B(T.CATEGORY.SAVE_SUB_ENTITY(x.value),o)}$.value="Saved successfully ✅",N.value="success",await O(),R()}catch(o){$.value=((t=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:t.message)||"Something went wrong",N.value="error"}finally{S.value=!1}},F=async(l,t)=>{if(confirm("Delete this item?"))try{await ce(T.CATEGORY.DELETE_ENTITY(l,t)),await O()}catch(o){console.error("Delete failed:",o)}},J=async(l,t)=>{try{await pe(T.CATEGORY.TOGGLE_STATUS(l,t)),await O()}catch(o){console.error("Toggle failed:",o)}},le=l=>{n.value&&(c.value="sub",x.value=n.value._id||"",s.id=l._id||"",s.name=l.name||"",s.description=l.description||"",s.image=l.image||"",s.status=l.status??!0,s.attribute=l.attribute||[],k.value=s.attribute.join(", "),C.value=null,w.value=s.image?M(s.image):"",E.value=!0)};return ie(()=>{O(),Z()}),(l,t)=>(r(),X(de,null,{default:L(()=>{var o,f,W,q;return[ne(ue,{pageTitle:"Categories"}),$.value?(r(),i("div",{key:0,class:U(["mb-4 px-4 py-3 rounded text-sm font-medium",N.value==="success"?"bg-green-100 text-green-800 border border-green-300":"bg-red-100 text-red-800 border border-red-300"])},d($.value),3)):p("",!0),e("div",_e,[e("div",he,[e("div",null,[e("h2",ke,d(m.value==="categories"?"Categories":`Subcategories of ${((o=n.value)==null?void 0:o.name)??""}`),1),m.value==="subcategories"?(r(),i("p",Ce," Showing subcategories inside: "+d((f=n.value)==null?void 0:f.name),1)):p("",!0)]),e("div",we,[m.value==="subcategories"?(r(),i("button",{key:0,onClick:te,class:"px-3 py-2 border rounded-lg text-sm"}," ← Back to Categories ")):p("",!0),m.value==="subcategories"?(r(),i("button",{key:1,onClick:t[0]||(t[0]=a=>{var y;return P("sub",null,(y=n.value)==null?void 0:y._id)}),class:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm"}," + Add Subcategory ")):p("",!0),e("button",{onClick:t[1]||(t[1]=a=>P("main")),class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm"}," + Add Category ")])]),e("div",Se,[e("table",$e,[e("thead",Te,[m.value==="categories"?(r(),i("tr",Ee,t[13]||(t[13]=[e("th",{class:"px-4 py-2"},"Image",-1),e("th",{class:"px-4 py-2"},"Name",-1),e("th",{class:"px-4 py-2"},"Attributes",-1),e("th",{class:"px-4 py-2 text-center"},"Subcategories",-1),e("th",{class:"px-4 py-2 text-center"},"Status",-1),e("th",{class:"px-4 py-2 text-center"},"Actions",-1)]))):(r(),i("tr",Ae,t[14]||(t[14]=[e("th",{class:"px-4 py-2"},"Image",-1),e("th",{class:"px-4 py-2"},"Name",-1),e("th",{class:"px-4 py-2"},"Commission (%)",-1),e("th",{class:"px-4 py-2 text-center"},"Status",-1),e("th",{class:"px-4 py-2 text-center"},"Actions",-1)])))]),m.value==="categories"?(r(),i("tbody",Ne,[(r(!0),i(V,null,I(v.value,a=>{var y;return r(),i("tr",{key:a._id,class:"border-t hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",Ue,[e("img",{src:M(a.image),class:"h-10 w-10 rounded-md object-cover"},null,8,Ve)]),e("td",Ie,d(a.name),1),e("td",je,d((a.attribute??[]).join(", ")||"-"),1),e("td",Me,[e("button",{onClick:g=>ee(a),class:"text-blue-600 underline"},d(((y=a.subcat)==null?void 0:y.length)??0),9,Oe)]),e("td",Le,[e("button",{onClick:g=>J(a._id),class:U(["px-2 py-1 text-xs rounded text-white",a.status?"bg-green-500":"bg-red-500"])},d(a.status?"Active":"Inactive"),11,De)]),e("td",Ge,[e("button",{onClick:g=>P("main",a),class:"px-2 py-1 bg-yellow-400 hover:bg-yellow-500 text-white text-xs rounded"}," Edit ",8,Pe),e("button",{onClick:g=>F(a._id),class:"px-2 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded"}," Delete ",8,Re)])])}),128))])):(r(),i("tbody",Ye,[(r(!0),i(V,null,I(((W=n.value)==null?void 0:W.subcat)??[],a=>(r(),i("tr",{key:a._id,class:"border-t hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",Be,[e("img",{src:M(a.image),class:"h-10 w-10 rounded-md object-cover"},null,8,ze)]),e("td",Fe,d(a.name),1),e("td",Je,d(a.commison??"-"),1),e("td",We,[e("button",{onClick:y=>J(n.value._id,a._id),class:U(["px-2 py-1 text-xs rounded text-white",a.status?"bg-green-500":"bg-red-500"])},d(a.status?"Active":"Inactive"),11,qe)]),e("td",Xe,[e("button",{onClick:y=>le(a),class:"px-2 py-1 bg-yellow-400 hover:bg-yellow-500 text-white text-xs rounded"}," Edit ",8,He),e("button",{onClick:y=>F(n.value._id,a._id),class:"px-2 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded"}," Delete ",8,Ke)])]))),128)),(((q=n.value)==null?void 0:q.subcat)??[]).length===0?(r(),i("tr",Qe,t[15]||(t[15]=[e("td",{colspan:"5",class:"text-center py-6 text-gray-500"},"No subcategories yet.",-1)]))):p("",!0)]))])]),m.value==="categories"&&v.value.length===0?(r(),i("div",Ze," No categories found ")):p("",!0)]),E.value?(r(),X(fe,{key:1,onClose:R},{title:L(()=>[h(d(c.value==="main"?s.id?"Edit Category":"Add Category":s.id?"Edit Subcategory":"Add Subcategory"),1)]),footer:L(()=>[e("div",xt,[e("button",{onClick:R,class:"px-4 py-2 border rounded"},"Cancel"),e("button",{onClick:ae,disabled:S.value,class:U(["px-4 py-2 rounded text-white flex items-center gap-2 justify-center",S.value?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"])},[S.value?(r(),i("svg",_t)):p("",!0),h(" "+d(S.value?"Saving...":"Save"),1)],10,ft)])]),default:L(()=>[e("div",et,[s.id?p("",!0):(r(),i("div",tt,[t[18]||(t[18]=e("span",{class:"text-sm font-medium"},"Type:",-1)),e("label",st,[b(e("input",{type:"radio",value:"main","onUpdate:modelValue":t[2]||(t[2]=a=>c.value=a)},null,512),[[j,c.value]]),t[16]||(t[16]=h(" Main Category "))]),e("label",at,[b(e("input",{type:"radio",value:"sub","onUpdate:modelValue":t[3]||(t[3]=a=>c.value=a)},null,512),[[j,c.value]]),t[17]||(t[17]=h(" Subcategory "))])])),c.value==="main"?(r(),i("div",lt,[t[22]||(t[22]=e("span",{class:"text-sm font-medium"},"Category Type:",-1)),e("label",ot,[b(e("input",{type:"radio",value:"products","onUpdate:modelValue":t[4]||(t[4]=a=>s.type=a)},null,512),[[j,s.type]]),t[19]||(t[19]=h(" Products "))]),e("label",rt,[b(e("input",{type:"radio",value:"service","onUpdate:modelValue":t[5]||(t[5]=a=>s.type=a)},null,512),[[j,s.type]]),t[20]||(t[20]=h(" Service "))]),e("label",it,[b(e("input",{type:"radio",value:"living","onUpdate:modelValue":t[6]||(t[6]=a=>s.type=a)},null,512),[[j,s.type]]),t[21]||(t[21]=h(" Living "))])])):p("",!0),e("div",null,[t[24]||(t[24]=e("label",{class:"block mb-1 text-sm font-medium"},"City & Price",-1)),(r(!0),i(V,null,I(A.value,(a,y)=>(r(),i("div",{key:y,class:"flex items-center gap-2 mb-2"},[b(e("select",{class:"border rounded p-2 w-1/2","onUpdate:modelValue":g=>a.cityId=g},[t[23]||(t[23]=e("option",{disabled:"",value:""},"Select city",-1)),(r(!0),i(V,null,I(z.value,g=>(r(),i("option",{key:g._id,value:g._id},d(g.city),9,dt))),128))],8,nt),[[H,a.cityId]]),b(e("input",{type:"number",placeholder:"Price",class:"border rounded p-2 w-1/3","onUpdate:modelValue":g=>a.price=g},null,8,ut),[[D,a.price,void 0,{number:!0}]]),e("button",{class:"bg-red-500 text-white px-2 py-1 rounded",onClick:g=>A.value.splice(y,1)}," X ",8,ct)]))),128)),e("button",{class:"px-3 py-1 bg-green-600 text-white rounded text-xs",onClick:t[7]||(t[7]=a=>A.value.push({cityId:"",price:0}))}," + Add City Price ")]),c.value==="sub"?(r(),i("div",pt,[t[26]||(t[26]=e("label",{class:"block mb-1 text-sm font-medium"},"Parent Category",-1)),b(e("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>x.value=a),class:"w-full border rounded p-2 text-sm"},[t[25]||(t[25]=e("option",{value:""},"Select parent category",-1)),(r(!0),i(V,null,I(v.value,a=>(r(),i("option",{key:a._id,value:a._id},d(a.name),9,vt))),128))],512),[[H,x.value]])])):p("",!0),e("div",null,[e("label",gt,d(c.value==="main"?"Category Name":"Subcategory Name"),1),b(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>s.name=a),placeholder:"Name",class:"w-full border rounded p-2"},null,512),[[D,s.name]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block mb-1 text-sm font-medium"},"Description",-1)),b(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=a=>s.description=a),placeholder:"Description",class:"w-full border rounded p-2"},null,512),[[D,s.description]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block mb-1 text-sm font-medium"},"Image",-1)),e("input",{type:"file",accept:"image/*",onChange:se,class:"border p-2 rounded w-full"},null,32),w.value?(r(),i("div",mt,[e("img",{src:w.value,class:"h-20 w-20 object-cover rounded border"},null,8,yt)])):p("",!0)]),e("div",null,[t[29]||(t[29]=e("label",{class:"block mb-1 text-sm font-medium"}," Attributes (comma separated) ",-1)),b(e("input",{"onUpdate:modelValue":t[11]||(t[11]=a=>k.value=a),placeholder:"e.g. Size, Color",class:"border rounded p-2 w-full"},null,512),[[D,k.value]])]),e("div",bt,[t[30]||(t[30]=e("label",{class:"text-sm font-medium"},"Status:",-1)),e("button",{type:"button",onClick:t[12]||(t[12]=a=>s.status=!s.status),class:U(["px-3 py-1 rounded text-xs text-white",s.status?"bg-green-500":"bg-red-500"])},d(s.status?"Active":"Inactive"),3)])])]),_:1})):p("",!0)]}),_:1}))}});export{$t as default};
