import{r as l,k as j,g as A,h as p,o as n,l as C,d as e,c,t as u,n as D,j as x,F as q,f as z,i as G,w as N,y as B,z as O}from"./index-DRCwg4EZ.js";import{_ as R}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Bdc2VVU4.js";import{_ as H}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-T41Zm9iO.js";import{_ as J}from"./BaseTable.vue_vue_type_script_setup_true_lang-wmfEEMhB.js";import{_ as K}from"./BaseModal-DiLMXNfp.js";import{g as Q,E as P,p as V}from"./endpoint-CWNBtn7N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"p-6 bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800"},X={key:1,class:"py-10 flex justify-center"},Y={key:2,class:"overflow-x-auto"},Z={class:"px-4 py-2"},ee={class:"px-4 py-2 font-medium"},te={class:"px-4 py-2"},se={class:"px-4 py-2"},ae={class:"px-4 py-2"},re={class:"px-4 py-2 text-center"},oe=["onClick"],le={key:0,class:"text-center py-10 text-gray-500"},ne={class:"grid grid-cols-1 gap-4"},ue={key:0,class:"px-3 py-2 rounded text-sm bg-red-100 text-red-800"},de={class:"flex items-center gap-2"},ie=["disabled"],xe={__name:"BannerPlans",setup(ce){const b=l([]),_=l(!0),g=l(!1),f=l(!1),d=l(!1),v=l(""),o=l(""),m=l({show:!1,type:"success",message:""}),r=l({duration:"",price:"",status:!0}),I=s=>{m.value={show:!0,type:"success",message:s}},M=s=>{m.value={show:!0,type:"error",message:s}},E=()=>{r.value={duration:"",price:"",status:!0}},T=()=>{d.value=!1,v.value="",o.value="",E(),f.value=!0},F=s=>{d.value=!0,v.value=(s==null?void 0:s._id)||"",o.value="",r.value={duration:String((s==null?void 0:s.duration)||""),price:Number.isFinite(Number(s==null?void 0:s.price))?Number(s.price):"",status:!!(s!=null&&s.status)},f.value=!0},h=()=>{d.value=!1,v.value="",f.value=!1,o.value="",E()},L=s=>{const t=Number(s);return Number.isFinite(t)?`Rs. ${t.toLocaleString("en-IN")}`:"-"},$=s=>{if(!s)return"-";const t=new Date(s);return Number.isNaN(t.getTime())?"-":t.toLocaleDateString()},S=async()=>{var s,t;_.value=!0;try{const a=await Q(P.GET_PLANS,{includeInactive:!0});b.value=Array.isArray(a==null?void 0:a.data)?a.data:[]}catch(a){console.error(a),b.value=[],M(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||"Error fetching banner plans.")}finally{_.value=!1}},U=async()=>{var y,w;o.value="";const s=String(r.value.duration||"").trim();if(!s){o.value="Duration is required";return}const t=Number(r.value.price);if(!Number.isFinite(t)){o.value="Valid price is required";return}g.value=!0;const a=d.value;try{if(a&&!v.value){o.value="Invalid plan selected for editing";return}const i={duration:s,price:t,status:!!r.value.status},k=a?await V(P.EDIT_PLANS(v.value),i):await V(P.ADD_PLANS,i);h(),I((k==null?void 0:k.message)||(a?"Banner plan updated successfully.":"Banner plan added successfully.")),await S()}catch(i){console.error(i),o.value=((w=(y=i==null?void 0:i.response)==null?void 0:y.data)==null?void 0:w.message)||(a?"Error updating banner plan.":"Error adding banner plan.")}finally{g.value=!1}};return j(()=>{S()}),(s,t)=>(n(),A(R,null,{default:p(()=>[C(H,{pageTitle:"Banner Plans"}),e("div",W,[e("div",{class:"flex justify-between items-center mb-4"},[t[3]||(t[3]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"}," Banner Plans ",-1)),e("button",{onClick:T,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg"}," + Add Plan ")]),m.value.show?(n(),c("div",{key:0,class:D(["mb-4 px-4 py-3 rounded text-sm",m.value.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},u(m.value.message),3)):x("",!0),_.value?(n(),c("div",X,t[4]||(t[4]=[e("div",{class:"h-8 w-8 rounded-full animate-spin border-4 border-gray-200 border-t-blue-600"},null,-1)]))):(n(),c("div",Y,[C(J,null,{head:p(()=>t[5]||(t[5]=[e("th",{class:"px-4 py-2"},"#",-1),e("th",{class:"px-4 py-2"},"Duration",-1),e("th",{class:"px-4 py-2"},"Price",-1),e("th",{class:"px-4 py-2"},"Status",-1),e("th",{class:"px-4 py-2"},"Created",-1),e("th",{class:"px-4 py-2 text-center"},"Actions",-1)])),body:p(()=>[(n(!0),c(q,null,z(b.value,(a,y)=>(n(),c("tr",{key:a._id||y,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",Z,u(y+1),1),e("td",ee,u(a.duration||"-"),1),e("td",te,u(L(a.price)),1),e("td",se,[e("span",{class:D(["px-2 py-1 rounded text-xs font-medium",a.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},u(a.status?"Active":"Inactive"),3)]),e("td",ae,u($(a.createdAt)),1),e("td",re,[e("button",{onClick:w=>F(a),class:"px-3 py-1 bg-yellow-500 hover:bg-yellow-600 text-white rounded text-xs"}," Edit ",8,oe)])]))),128))]),_:1}),b.value.length===0?(n(),c("div",le," No banner plans found ")):x("",!0)]))]),f.value?(n(),A(K,{key:0,onClose:h},{title:p(()=>[G(u(d.value?"Edit Banner Plan":"Add Banner Plan"),1)]),footer:p(()=>[e("button",{onClick:h,class:"px-4 py-2 border rounded"}," Cancel "),e("button",{onClick:U,disabled:g.value,class:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-60"},u(g.value?d.value?"Updating...":"Saving...":d.value?"Update":"Save"),9,ie)]),default:p(()=>[e("div",ne,[o.value?(n(),c("div",ue,u(o.value),1)):x("",!0),e("div",null,[t[6]||(t[6]=e("label",{class:"font-medium text-sm mb-1 block"},"Duration",-1)),N(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>r.value.duration=a),type:"text",class:"border rounded p-2 h-10 w-full",placeholder:"e.g. 7 days"},null,512),[[B,r.value.duration]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"font-medium text-sm mb-1 block"},"Price",-1)),N(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>r.value.price=a),type:"number",min:"0",step:"0.01",class:"border rounded p-2 h-10 w-full",placeholder:"0"},null,512),[[B,r.value.price]])]),e("div",de,[N(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>r.value.status=a),type:"checkbox"},null,512),[[O,r.value.status]]),t[8]||(t[8]=e("label",{class:"font-medium text-sm"},"Active",-1))])])]),_:1})):x("",!0)]),_:1}))}};export{xe as default};
