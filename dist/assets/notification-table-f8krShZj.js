import{r as n,k as G,g as I,h as d,o,l as T,d as e,c as i,t as r,n as L,j as y,F as E,f as A,i as R,w as b,y as O,x as z}from"./index-DRCwg4EZ.js";import{_ as P}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Bdc2VVU4.js";import{_ as Y}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-T41Zm9iO.js";import{_ as q}from"./BaseModal-DiLMXNfp.js";import{_ as H}from"./BaseTable.vue_vue_type_script_setup_true_lang-wmfEEMhB.js";import{g as S,E as p,p as w}from"./endpoint-CWNBtn7N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"p-6 bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800"},K={key:1,class:"py-10 flex justify-center"},Q={key:2,class:"overflow-x-auto"},W={class:"px-4 py-2"},X=["src"],Z={key:1,class:"text-xs text-gray-400"},ee={class:"px-4 py-2 font-medium"},te={class:"px-4 py-2 text-sm text-gray-600"},se={class:"px-4 py-2 text-sm"},ae={key:0},le={key:1},oe={class:"px-4 py-2 text-center space-x-2"},ie=["onClick"],ne=["onClick"],re={key:0,class:"text-center py-10 text-gray-500"},de={class:"grid grid-cols-1 gap-4"},ue=["value"],ce={key:0,class:"mt-3"},pe=["src"],ve=["disabled"],he={__name:"notification-table",setup(me){const D="https://fivliaproject.s3.eu-north-1.amazonaws.com",g=n([]),h=n([]),f=n(!0),v=n(!1),x=n({message:"",type:"success"}),u=n(!1),m=n(!1),_=n(""),c=n(null),l=n({title:"",description:"",city:"everyone",image:null}),k=s=>s?D+s:"",N=async()=>{f.value=!0;const s=await S(p.GET_NOTIFICATION);g.value=s.data||[],f.value=!1},j=async()=>{h.value=await S(p.GET_CITY)};G(()=>{N(),j()});const F=s=>{const t=s.target.files[0];t&&(l.value.image=t,c.value=URL.createObjectURL(t))},V=()=>{m.value=!1,_.value="",l.value={title:"",description:"",city:"everyone",image:null},c.value=null,u.value=!0},$=s=>{var t;m.value=!0,_.value=s._id,l.value.title=s.title,l.value.description=s.description,l.value.city=(t=s.city)!=null&&t.length?s.city:"everyone",l.value.image=null,c.value=s.image?k(s.image):null,u.value=!0},M=async()=>{v.value=!0;const s=new FormData;s.append("title",l.value.title),s.append("description",l.value.description),l.value.city!=="everyone"&&s.append("city",l.value.city),l.value.image&&s.append("image",l.value.image),m.value?await w(p.EDIT_NOTIFICATION(_.value),s):await w(p.CREATE_NOTIFICATION,s),u.value=!1,v.value=!1,N()},U=async s=>{confirm("Send notification now?")&&await w(p.SEND_NOTIFICATION,{notificationId:s,radius:5})};return(s,t)=>(o(),I(P,null,{default:d(()=>[T(Y,{pageTitle:"Notifications"}),e("div",J,[e("div",{class:"flex justify-between items-center mb-4"},[t[4]||(t[4]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"}," Notifications ",-1)),e("button",{onClick:V,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg"}," + Add Notification ")]),x.value.message?(o(),i("div",{key:0,class:L(["mb-4 px-4 py-3 rounded text-sm",x.value.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},r(x.value.message),3)):y("",!0),f.value?(o(),i("div",K,t[5]||(t[5]=[e("div",{class:"h-8 w-8 rounded-full animate-spin border-4 border-gray-200 border-t-blue-600"},null,-1)]))):(o(),i("div",Q,[T(H,null,{head:d(()=>t[6]||(t[6]=[e("th",{class:"px-4 py-2"},"Image",-1),e("th",{class:"px-4 py-2"},"Title",-1),e("th",{class:"px-4 py-2"},"Description",-1),e("th",{class:"px-4 py-2"},"Cities",-1),e("th",{class:"px-4 py-2 text-center"},"Actions",-1)])),body:d(()=>[(o(!0),i(E,null,A(g.value,a=>{var C;return o(),i("tr",{key:a._id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",W,[a.image?(o(),i("img",{key:0,src:k(a.image),class:"h-12 w-20 rounded object-cover border"},null,8,X)):(o(),i("span",Z,"No image"))]),e("td",ee,r(a.title),1),e("td",te,r(a.description),1),e("td",se,[(C=a.city)!=null&&C.length?(o(),i("span",le,r(a.city.length)+" selected",1)):(o(),i("span",ae,"All"))]),e("td",oe,[e("button",{onClick:B=>$(a),class:"px-2 py-1 bg-yellow-500 text-white rounded text-xs"}," Edit ",8,ie),e("button",{onClick:B=>U(a._id),class:"px-2 py-1 bg-green-600 text-white rounded text-xs"}," Send ",8,ne)])])}),128))]),_:1}),g.value.length===0?(o(),i("div",re," No notifications found ")):y("",!0)]))]),u.value?(o(),I(q,{key:0},{title:d(()=>[R(r(m.value?"Edit Notification":"Add Notification"),1)]),footer:d(()=>[e("button",{onClick:t[3]||(t[3]=a=>u.value=!1),class:"px-4 py-2 border rounded"}," Cancel "),e("button",{onClick:M,disabled:v.value,class:"px-4 py-2 bg-blue-600 text-white rounded"},r(v.value?"Saving...":"Save"),9,ve)]),default:d(()=>[e("div",de,[e("div",null,[t[7]||(t[7]=e("label",{class:"font-medium text-sm"},"Title",-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>l.value.title=a),class:"border rounded p-2 h-10 w-full"},null,512),[[O,l.value.title]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"font-medium text-sm"},"Description",-1)),b(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>l.value.description=a),rows:"3",class:"border rounded p-2 w-full"},null,512),[[O,l.value.description]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"font-medium text-sm"},"Cities",-1)),b(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>l.value.city=a),class:"border rounded p-2 h-10 w-full"},[t[9]||(t[9]=e("option",{value:"everyone"},"Send to Everyone",-1)),(o(!0),i(E,null,A(h.value,a=>(o(),i("option",{key:a._id,value:a._id},r(a.city),9,ue))),128))],512),[[z,l.value.city]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"font-medium text-sm"},"Image",-1)),e("input",{type:"file",accept:"image/*",onChange:F,class:"border rounded p-2 w-full"},null,32),c.value?(o(),i("div",ce,[e("img",{src:c.value,class:"h-32 rounded border object-cover"},null,8,pe)])):y("",!0)])])]),_:1})):y("",!0)]),_:1}))}};export{he as default};
